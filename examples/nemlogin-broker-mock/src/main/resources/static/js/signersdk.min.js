!function(s){s.namespace=function(t){var e=t.split(".");if("Cryptomathic"!==e[0])throw Error("namespace string must start with 'Cryptomathic' and the namespace parts must be seperated with '.'");for(var r,n=s,i=1,o=e.length;i<o;i++)n[r=e[i]]=n[r]||{},n=n[r];return n}}(Cryptomathic=Cryptomathic||{}),function(t){(t.SignerUserSDK||(t.SignerUserSDK={})).componentVersion="5.3.4-SNAPSHOT"}(Cryptomathic=Cryptomathic||{}),function(t){(t=(t=t.SignerUserSDK||(t.SignerUserSDK={})).ErrorTypes||(t.ErrorTypes={}))[t.IllegalState=1]="IllegalState",t[t.ConnectionError=2]="ConnectionError",t[t.SignerError=3]="SignerError",t[t.NotInitializedError=4]="NotInitializedError",t[t.CryptoError=5]="CryptoError",t[t.UnknownError=6]="UnknownError",t[t.InvalidResponseError=7]="InvalidResponseError",t[t.SerializationError=8]="SerializationError",t[t.InvalidArgumentError=9]="InvalidArgumentError",t[t.AuthTokenError=10]="AuthTokenError",t[t.BigNumError=11]="BigNumError",t[t.NoSckError=12]="NoSckError",t[t.SecureEnvError=13]="SecureEnvError",t[t.NoCtkError=14]="NoCtkError"}(Cryptomathic=Cryptomathic||{}),function(t){(t.SignerUserSDK||(t.SignerUserSDK={})).copyright="Copyright (C) 2022 Cryptomathic A/S."}(Cryptomathic=Cryptomathic||{}),function(t){(t=(t=t.Crypto||(t.Crypto={})).Digest||(t.Digest={}))[t.SHA1=1]="SHA1",t[t.SHA256=2]="SHA256",t[t.SHA384=3]="SHA384",t[t.SHA512=4]="SHA512"}(Cryptomathic=Cryptomathic||{}),function(t){(t=(t=t.Crypto||(t.Crypto={})).HashAlgorithm||(t.HashAlgorithm={}))[t.SHA256=2]="SHA256",t[t.SHA384=3]="SHA384",t[t.SHA512=4]="SHA512"}(Cryptomathic=Cryptomathic||{}),function(t){!function(t){function e(t,e){this.challengeId=t,this.challengeData=e}e.prototype.getChallengeId=function(){return this.challengeId},e.prototype.getChallengeData=function(){return this.challengeData},t.AuthenticationChallenge=e}(t.Messages||(t.Messages={}))}(Cryptomathic=Cryptomathic||{}),function(t){!function(t){function e(t,e,r){this.tokenType=t,this.tokenSerial=e,this.tokenTag=r}e.prototype.getTokenType=function(){return this.tokenType},e.prototype.getTokenSerial=function(){return this.tokenSerial},e.prototype.getTokenTag=function(){return this.tokenTag},t.AuthenticationToken=e}(t.Messages||(t.Messages={}))}(Cryptomathic=Cryptomathic||{}),function(t){(t=(t=t.Messages||(t.Messages={})).PolicyAuthenticationLevel||(t.PolicyAuthenticationLevel={}))[t.NA=0]="NA",t[t.ANONYMOUS=1]="ANONYMOUS",t[t.ONE_FACTOR=2]="ONE_FACTOR",t[t.TWO_FACTOR=3]="TWO_FACTOR",t[t.DISABLED=127]="DISABLED"}(Cryptomathic=Cryptomathic||{}),function(t){(t=(t=t.Messages||(t.Messages={})).PolicyKeyLevel||(t.PolicyKeyLevel={}))[t.EXPORTABLE=0]="EXPORTABLE",t[t.RECOVERABLE=10]="RECOVERABLE",t[t.STANDARD=20]="STANDARD",t[t.PASSWORD_ENCRYPTED=30]="PASSWORD_ENCRYPTED"}(Cryptomathic=Cryptomathic||{}),function(t){(t=(t=t.Messages||(t.Messages={})).SignatureType||(t.SignatureType={}))[t.RAW=3]="RAW",t[t.SIGN_PSS=1]="SIGN_PSS",t[t.SIGN_PSS_UNSALTED=4]="SIGN_PSS_UNSALTED",t[t.SIGN_PKCS1=2]="SIGN_PKCS1",t[t.SIGN_ECDSA=5]="SIGN_ECDSA"}(Cryptomathic=Cryptomathic||{});var Cryptomathic,__awaiter=this&&this.__awaiter||function(t,s,a,c){return new(a=a||Promise)(function(r,e){function n(t){try{o(c.next(t))}catch(t){e(t)}}function i(t){try{o(c.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?r(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(n,i)}o((c=c.apply(t,s||[])).next())})},__generator=this&&this.__generator||function(n,i){var o,s,a,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(r){return function(t){var e=[r,t];if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,s&&(a=2&e[0]?s.return:e[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,e[1])).done)return a;switch(s=0,(e=a?[2&e[0],a.value]:e)[0]){case 0:case 1:a=e;break;case 4:return c.label++,{value:e[1],done:!1};case 5:c.label++,s=e[1],e=[0];continue;case 7:e=c.ops.pop(),c.trys.pop();continue;default:if(!(a=0<(a=c.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){c=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){c.label=e[1];break}if(6===e[0]&&c.label<a[1]){c.label=a[1],a=e;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(e);break}a[2]&&c.ops.pop(),c.trys.pop();continue}e=i.call(n,c)}catch(t){e=[6,t],s=0}finally{o=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}}},Es5Error=(!function(t){!function(t){function e(t,e,r){this.type=t,this.message=t+": "+e,this.msg=e,this.signerErrorCode=r||null}e.prototype.getType=function(){return this.type},e.prototype.getMessage=function(){return this.msg},e.prototype.getSignerErrorCode=function(){return this.signerErrorCode},e.prototype.setSignerErrorCode=function(t){this.signerErrorCode=t},t.CrmError=e}(t.Error||(t.Error={}))}(Cryptomathic=Cryptomathic||{}),!function(t){var e,n,i;e=(e=(e=t.Messages||(t.Messages={})).Tags||(e.Tags={})).Utils||(e.Utils={}),n=t.Error.CrmError,i=t.SignerUserSDK.ErrorTypes,e.assertLength=function(t,e,r){if(t.length!==e)throw new n(i.InvalidArgumentError,r+" data should be "+e+" bytes long, but was "+t.length+" bytes long")}}(Cryptomathic=Cryptomathic||{}),!function(t){var e,f,y,d;e=(e=(e=t.Messages||(t.Messages={})).Tags||(e.Tags={})).TLV||(e.TLV={}),f=t.Error.CrmError,y=t.SignerUserSDK.ErrorTypes,d=6,e.parse=function(t,e,r,n,i){var o,s,a,c,u,g,h=n||0,l=i||t.length;if(l>t.length)throw new f(y.SerializationError,"too little data to begin with");for(;h<l;){if(l<h+d)throw new f(y.SerializationError,"too little data left");g=u=c=a=s=void 0,s=256*(o=t)[p=h]+o[p+1],a=o[p+5]+256*(o[p+4]+256*(o[p+3]+256*o[p+2])),u=(c=p+d)+a,g=o.slice(c,u),o=o.slice(p,u);var p={tag:s,length:a,contentStart:c,contentEnd:u,content:g,raw:o};if(l<p.contentEnd)throw new f(y.SerializationError,"too little data left");e=r(e,p),h=p.contentEnd}return e}}(Cryptomathic=Cryptomathic||{}),!function(r){var t,n,i,o;function s(){return{get:function(t){return t.get(this)},getOptional:function(t){return t.getOptional(this)}}}function a(t,e,r){e=c(t,e,r);if(void 0===e)throw new n(i.SerializationError,"Expected tag "+t+" in response, but found none");return e}function c(t,e,r){e=e[t];return e?r(e):void 0}function u(t,e){return e?g(t).concat(r.Messages.Tags.encodeInt(e.length),e):[]}function g(t){return[t>>>8&255,255&t]}t=(t=r.Messages||(r.Messages={})).Tags||(t.Tags={}),n=r.Error.CrmError,i=r.SignerUserSDK.ErrorTypes,o=r.Messages.Tags.TLV.parse,t.makeTag=function(r,n){return function(e){return{tag:e,get:function(t){return a(e,t,n)},getOptional:function(t){return c(e,t,n)},encode:function(t){return u(e,r(t))}}}},t.emptyTagMap=s,t.parseTags=function(t,e,r){var n=s();return o(t,n,function(t,e){return t[e.tag]=e.content,t},e,r)},t.get=a,t.getOptional=c,t.encodeTag=u,t.encodeShort=g}(Cryptomathic=Cryptomathic||{}),!function(t){var e,r;function n(t){return[t]}function i(t){return r(t,1,"Byte"),t[0]}e=(e=t.Messages||(t.Messages={})).Tags||(e.Tags={}),r=t.Messages.Tags.Utils.assertLength,e.byteTag=e.makeTag(n,i),e.encodeByte=n,e.asByte=i}(Cryptomathic=Cryptomathic||{}),!function(t){function e(t){return t}function r(t){return t}(t=(t=t.Messages||(t.Messages={})).Tags||(t.Tags={})).bytesTag=t.makeTag(r,e),t.asBytes=e,t.encodeBytes=r}(Cryptomathic=Cryptomathic||{}),!function(t){var e,n,i;e=(e=t.Utils||(t.Utils={})).ByteArrayUtils||(e.ByteArrayUtils={}),n=t.Error.CrmError,i=t.SignerUserSDK.ErrorTypes,e.compare=function(t,e){if(t.length!==e.length)return!1;for(var r=t.length,n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0},e.xor=function(t,r){if(t.length!==r.length)throw new n(i.InvalidArgumentError,"cannot xor arrays of unequal length (len(one)="+t.length+", len(other)="+r.length+")");return t.map(function(t,e){return t^r[e]})},e.emptyArray=function(t,e){var r=e||0,n=new Array(t);if(Array.prototype.fill)return n.fill(r);for(var i=0;i<t;i++)n[i]=r;return n},e.convertToNumberArray=function(t){return t instanceof Array?t:Array.prototype.slice.call(t)},e.convertToByteArray=function(t){return t instanceof Uint8Array?t:Array.prototype.slice.call(t)},e.concat=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if("function"!=typeof Uint8Array.prototype.set)return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=Array.prototype.map.call(t,function(t){return Array.prototype.slice.call(t)});return new Uint8Array([].concat(r))}.apply(void 0,t);var r=t.reduce(function(t,e){return t+e.length},0),n=new Uint8Array(r);return t.reduce(function(t,e){return n.set(e,t),t+e.length},0),n}}(Cryptomathic=Cryptomathic||{}),!function(t){var e,r,n,i;function o(t){return t?n.decode(new Uint8Array(t)):void 0}function s(t){return r(i.encode(t))}e=(e=t.Messages||(t.Messages={})).Tags||(e.Tags={}),r=t.Utils.ByteArrayUtils.convertToNumberArray,e.stringTag=e.makeTag(s,o),n=new TextDecoder,i=new TextEncoder,e.asString=o,e.encodeString=s}(Cryptomathic=Cryptomathic||{}),!function(t){var e,r;function n(t){return r(t,4,"Integer"),t[3]+256*(t[2]+256*(t[1]+256*t[0]))}function i(t){return[t>>24&255,t>>16&255,t>>8&255,255&t]}e=(e=t.Messages||(t.Messages={})).Tags||(e.Tags={}),r=t.Messages.Tags.Utils.assertLength,e.intTag=e.makeTag(i,n),e.asInt=n,e.encodeInt=i}(Cryptomathic=Cryptomathic||{}),!function(t){(t=(t=t.Messages||(t.Messages={})).Tags||(t.Tags={})).HsmResponse={sequenceNumber:t.intTag(1),returnCode:t.intTag(2),sessionAuthLevel:t.byteTag(3),signature:t.bytesTag(16),authenticationChallengeId:t.stringTag(50),authenticationChallengeData:t.stringTag(51),nonce:t.bytesTag(64),serverSessionKey:t.bytesTag(65)}}(Cryptomathic=Cryptomathic||{}),!function(t){var e,r,n,i,o,s;function a(t){switch(t){case 6:return"SMS";case 8:return"OATH-HOTP";case 9:return"OATH-TOTP";case 10:return"OATH-OCRA";default:throw new i(o.SerializationError,"Unknonwn value for token type: "+t)}}function c(t){switch(t){case"SMS":return 6;case"OATH-HOTP":return 8;case"OATH-TOTP":return 9;case"OATH-OCRA":return 10;default:throw new i(o.SerializationError,"Unknonwn name for a token type: "+t)}}function u(t){var e=c(t.getTokenType());return s.type.encode(e).concat(s.serial.encode(t.getTokenSerial()),s.tag.encode(t.getTokenTag()))}function g(t){t=r.parseTags(t);return new e.AuthenticationToken(a(t.get(s.type)),t.get(s.serial),t.get(s.tag))}e=t.Messages||(t.Messages={}),r=e.Tags||(e.Tags={}),n=r.Tokens||(r.Tokens={}),i=t.Error.CrmError,o=t.SignerUserSDK.ErrorTypes,s={type:r.byteTag(512),serial:r.stringTag(513),tag:r.stringTag(515)},n.tokenTag=r.makeTag(u,g),n.fromId=a,n.fromName=c,n.encodeToken=u,n.asToken=g}(Cryptomathic=Cryptomathic||{}),!function(t){var e;e=(e=t.Messages||(t.Messages={})).Tags||(e.Tags={}),t=t.Messages.Tags.Tokens.tokenTag,e.ServerCommand={commandId:e.byteTag(2e4),userKeyId:e.bytesTag(20001),token:t(20005),ctkId:e.bytesTag(20006),ctkEncryption:e.bytesTag(20007),challengeId:e.stringTag(20008),challengeData:e.stringTag(20009)}}(Cryptomathic=Cryptomathic||{}),!function(t){(t=(t=t.Messages||(t.Messages={})).Tags||(t.Tags={})).HsmCommand={sequenceNumber:t.intTag(1),commandId:t.byteTag(2),keyHash:t.bytesTag(18),policyGuid:t.bytesTag(19),signature:t.bytesTag(32),signaturedata:t.bytesTag(33),certificate:t.bytesTag(48),certificateDisplayText:t.bytesTag(49),tokenType:t.byteTag(512),tokenSerial:t.stringTag(513),tokenCredentials:t.bytesTag(515),policyName:t.bytesTag(516)}}(Cryptomathic=Cryptomathic||{}),!function(t){var e,r;function n(t){return r(t,1,"Boolean"),1===t[0]}function i(t){return[t?1:0]}e=(e=t.Messages||(t.Messages={})).Tags||(e.Tags={}),r=t.Messages.Tags.Utils.assertLength,e.booleanTag=e.makeTag(i,n),e.asBoolean=n,e.encodeBoolean=i}(Cryptomathic=Cryptomathic||{}),!function(t){var e,r,n,i;function o(t){return i(t,8,"Long"),t}function s(t){if(8!==t.length)throw new r(n.SerializationError,"expected 8 bytes of value for a long, but got "+t.length);return t}e=(e=t.Messages||(t.Messages={})).Tags||(e.Tags={}),r=t.Error.CrmError,n=t.SignerUserSDK.ErrorTypes,i=t.Messages.Tags.Utils.assertLength,e.longTag=e.makeTag(s,o),e.asLong=o,e.encodeLong=s}(Cryptomathic=Cryptomathic||{}),!function(t){(t=(t=t.Messages||(t.Messages={})).Tags||(t.Tags={})).Response={errorCode:t.intTag(1e4),sessionId:t.longTag(10010),authenticatorEnabled:t.booleanTag(10011),hsmEncryption:t.bytesTag(10001),serverEncryption:t.bytesTag(10002)}}(Cryptomathic=Cryptomathic||{}),!function(i){var o,t,s,a,c,u;o=i.Messages||(i.Messages={}),t=o.Response||(o.Response={}),s=i.Error.CrmError,a=i.SignerUserSDK.ErrorTypes,c=i.Messages.Tags.asInt,u=i.Messages.Tags.parseTags,t.parseSignerResponse=function(t,e,r){if(!Array.isArray(t)||t.length<8)throw new s(a.SerializationError,"Length of response is too short");var n=i.Utils.StringUtils.bytes2string(t.slice(0,4));if(n!==e)throw new s(a.SerializationError,"Unexpected response type: "+n+" (expected "+e+")");if(c(t.slice(4,8))+8!==t.length)throw new s(a.SerializationError,"Inconsistent response length");if(n=u(t,8),(e=n.get(o.Tags.Response.errorCode))!==o.SignerErrorCodes.OK&&e!==o.SignerErrorCodes.FORCED_LOGOFF)throw new s(a.SignerError,(r?r+" response contained":"Signer returned")+" error code: "+i.Messages.SignerErrorCodes.getError(e),e);return n}}(Cryptomathic=Cryptomathic||{}),!function(t){((t=t.Utils||(t.Utils={})).Errors||(t.Errors={})).isEs5Error=function(t){return void 0!==t.name&&void 0!==t.message}}(Cryptomathic=Cryptomathic||{}),!function(t){((t=t.Messages||(t.Messages={})).Sign||(t.Sign={})).isSignatureRequest=function(t){return!Array.isArray(t)}}(Cryptomathic=Cryptomathic||{}),!function(i){var t,n,r,o,s,a;function c(t,e){var r=e.OWNING_POLICY;if(!r)throw new o(i.SignerUserSDK.ErrorTypes.InvalidArgumentError,"Key must have an owning policy");if(!r.SIGNATURE_ALGORITHM)throw new o(i.SignerUserSDK.ErrorTypes.InvalidArgumentError,"Key policy must specify Signature Algorithm");if(r.SIGNATURE_TYPE===i.Messages.SignatureType.RAW)return!0;if(null==t)throw new o(i.SignerUserSDK.ErrorTypes.InvalidArgumentError,"Request is null");if(null==t.getAlgorithmIdentifier())throw new o(i.SignerUserSDK.ErrorTypes.InvalidArgumentError,"Request does not specify Signature Algorithm");switch(r.SIGNATURE_TYPE){case i.Messages.SignatureType.SIGN_PKCS1:return i.Utils.ByteArrayUtils.compare(r.SIGNATURE_ALGORITHM,t.getAlgorithmIdentifier());case i.Messages.SignatureType.SIGN_PSS:case i.Messages.SignatureType.SIGN_PSS_UNSALTED:var n=i.Messages.SignatureType.SIGN_PSS===r.SIGNATURE_TYPE;return t.useSalt!==n?!1:i.Utils.ByteArrayUtils.compare(r.SIGNATURE_ALGORITHM,t.getAlgorithmIdentifier());case i.Messages.SignatureType.SIGN_ECDSA:return!1;default:throw new o(i.SignerUserSDK.ErrorTypes.InvalidArgumentError,"Unrecognized User Key Operation "+r.SIGNATURE_TYPE)}}t=i.Messages||(i.Messages={}),t=(n=t.Sign||(t.Sign={})).Request||(n.Request={}),o=i.Error.CrmError,s=i.Messages.Tags.HsmCommand,a=i.Messages.Tags.ServerCommand,t.signCommandParts=function(t,e){return{serverContent:a.userKeyId.encode(t.KEY_ID),hsmContent:s.keyHash.encode(t.KEY_DIGEST).concat(s.signaturedata.encode(r.getBytesToSign(e,t)))}},(t=r=t.implementation||(t.implementation={})).compareSignatureTypes=c,t.getBytesToSign=function(t,e){var r;if(n.isSignatureRequest(t)){if(!c(t,e))throw new i.Error.CrmError(i.SignerUserSDK.ErrorTypes.InvalidArgumentError,"User operation on user privilege did not match signature request");r=e.OWNING_POLICY.SIGNATURE_TYPE===i.Messages.SignatureType.RAW?t.getPaddedRequest(e):t.hash}else r=t;return r}}(Cryptomathic=Cryptomathic||{}),!function(t){var e,n,i;e=t.Messages||(t.Messages={}),e=(n=e.Sign||(e.Sign={})).Response||(n.Response={}),i=t.Messages.Tags.HsmResponse,e.extractSignature=function(t,e,r){return t=t.get(i.signature),n.isSignatureRequest(e)?e.encodeSignerResponse(t,r):t}}(Cryptomathic=Cryptomathic||{}),!function(o){var t,s,a;function c(t,e,r,n){var i=t.getModulus().length;if(i<256)throw new s(a.CryptoError,"Only keys with length 2k or above is supported");i=o.Crypto.OAEP.oaepEncode(i,e);o.Crypto.Rsa.EncryptRsa(i,t,r,n)}t=(t=o.Crypto||(o.Crypto={})).CryptoUtils||(t.CryptoUtils={}),s=o.Error.CrmError,a=o.SignerUserSDK.ErrorTypes,t.createEncryptedContentForCreateSessionRequest=function(r,n,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,new Promise(function(t,e){c(r,o.Utils.ByteArrayUtils.concat(n,i),t,e)})]})})},t.encryptRsaWithOaep=c,t.asn1DigestInfo=function(t){var e=[48,(e=o.Crypto.Digest.toAsn1Oid(t).encode().concat(o.ASN1.Asn1Constants.nullAlgorithmIdentifierParameters.encode())).length].concat(e),t=o.Crypto.Digest.toAlgorithm(t);return[48,e.length+2+t.DIGEST_SIZE].concat(e).concat([4,t.DIGEST_SIZE])}}(Cryptomathic=Cryptomathic||{}),!function(t){(t=t.Crypto||(t.Crypto={})).gcmDecrypt=function(o,s){return __awaiter(this,void 0,void 0,function(){var e,r,n,i;return __generator(this,function(t){switch(t.label){case 0:return r=o.slice(0,12),e=o.slice(12,o.length),r={name:"AES-GCM",iv:new Uint8Array(r)},n=new Uint8Array(s),[4,crypto.subtle.importKey("raw",n,"AES-GCM",!1,["decrypt"])];case 1:return n=t.sent(),i=new Uint8Array(e),[4,crypto.subtle.decrypt(r,n,i)];case 2:return i=t.sent(),[2,Array.from(new Uint8Array(i))]}})})},t.gcmEncrypt=function(o,s){return __awaiter(this,void 0,void 0,function(){var e,r,n,i;return __generator(this,function(t){switch(t.label){case 0:return e=new Uint8Array(12),crypto.getRandomValues(e),r={name:"AES-GCM",iv:e},n=new Uint8Array(s),[4,crypto.subtle.importKey("raw",n,"AES-GCM",!1,["encrypt"])];case 1:return n=t.sent(),i=new Uint8Array(o),[4,crypto.subtle.encrypt(r,n,i)];case 2:return i=t.sent(),[2,Array.from(e).concat(Array.from(new Uint8Array(i)))]}})})}}(Cryptomathic=Cryptomathic||{}),!function(t){var e,r,n;function i(t){t=r.parseTags(t);return e.KeyEntry(t.get(n.keyId),t.get(n.publicKey),t.get(n.deprecationDate),t.getOptional(n.certificate),t.getOptional(n.displayText),t.get(n.keyDigest),void 0)}e=t.Messages||(t.Messages={}),r=e.Tags||(e.Tags={}),(t=r.Userkeys||(r.Userkeys={})).userKeyTag=r.makeTag(void 0,i),n={certificate:r.bytesTag(4e4),displayText:r.bytesTag(40001),keyId:r.longTag(40002),publicKey:r.bytesTag(40003),deprecationDate:r.longTag(40004),keyDigest:r.bytesTag(40005)},t.asUserKey=i}(Cryptomathic=Cryptomathic||{}),!function(t){var e,i,n,o,s;function a(e){return function(t){return r(t,e)}}function r(t,r,e,n){return s(t,[],function(t,e){e=i.parseTags(e.raw);return t.push(e.get(r)),t},e,n)}e=t.Messages||(t.Messages={}),i=e.Tags||(e.Tags={}),n=t.Error.CrmError,o=t.SignerUserSDK.ErrorTypes,s=t.Messages.Tags.TLV.parse,i.listTag=function(e,r){return{tag:e,get:function(t){return i.get(e,t,a(r))},getOptional:function(t){return i.getOptional(e,t,a(r))},encode:function(){throw new n(o.UnknownError,"Encoder not implemented for tag")}}},i.parseList=r}(Cryptomathic=Cryptomathic||{}),!function(s){var a,c,t,e,u;a=s.Messages||(s.Messages={}),c=a.Tags||(a.Tags={}),t=c.Policies||(c.Policies={}),e=s.Messages.Tags.Userkeys.userKeyTag,t.policyTag=c.makeTag(void 0,function(t){var t=c.parseTags(t),e=t.get(u.signAlgorithm),r=s.Utils.SignatureAlgorithmParser.extractSignatureType(e),e=s.Utils.SignatureAlgorithmParser.extractHashAlgorithm(e),n=r===s.Messages.SignatureType.RAW,i=t.get(u.tokenList).map(c.Tokens.fromId).join(":"),o=a.PolicyEntry(t.get(u.policyId),t.get(u.name),t.get(u.authenticationLevel),a.PolicyKeyLevel.STANDARD,!0,n,t.get(u.enabled),i,null,t.get(u.signAlgorithm),r,e);return o.KEY_LIST=t.get(u.userKeyList),o.KEY_LIST.forEach(function(t){return t.OWNING_POLICY=o}),o}),u={authenticationLevel:c.byteTag(3e4),enabled:c.booleanTag(30003),policyId:c.longTag(30004),userKeyList:c.listTag(30005,e(30006)),name:c.stringTag(30007),tokenList:c.bytesTag(30008),guid:c.bytesTag(30010),signAlgorithm:c.bytesTag(30013)}}(Cryptomathic=Cryptomathic||{}),!function(t){var e,r;e=(e=t.Messages||(t.Messages={})).Tags||(e.Tags={}),r=t.Messages.Tags.Tokens.tokenTag,t=t.Messages.Tags.Policies.policyTag,e.CreateSessionResponse={tokenList:e.listTag(20002,r(20003)),policyList:e.listTag(20004,t(20005))}}(Cryptomathic=Cryptomathic||{}),!function(t){var e,r,n;e=(e=(e=t.Messages||(t.Messages={})).Response||(e.Response={})).CreateSessionServer||(e.CreateSessionServer={}),r=t.Messages.Tags.CreateSessionResponse,n=t.Messages.Tags.parseTags,e.parse=function(t){return{tokens:(t=n(t)).get(r.tokenList),policies:t.get(r.policyList)}}}(Cryptomathic=Cryptomathic||{}),Error);!function(v){var b;(function(t){var m=v.Error.CrmError,h=v.Messages.Response.parseSignerResponse,l=v.Messages.Tags.emptyTagMap,p=v.Messages.Tags.HsmCommand,f=v.Messages.Tags.HsmResponse,y=v.Messages.Tags.parseTags,d=v.Messages.Tags.Response,S=v.Messages.Tags.ServerCommand,r=v.Utils.Errors.isEs5Error,C=v.Crypto.CryptoUtils,A=v.Messages.Response.CreateSessionServer,E=v.Crypto.gcmDecrypt,T=v.Crypto.gcmEncrypt;function I(t,e){t instanceof v.Error.CrmError?t.getType()===b.ErrorTypes.SignerError?e(t.getType(),t.getMessage(),t.getSignerErrorCode()):e(t.getType(),t.getMessage()):r(t)?e(b.ErrorTypes.UnknownError,t.name+": "+t.message):e(b.ErrorTypes.UnknownError,"Unknown error")}function w(t,e,r){this.connection=new v.Comm.SignerConnection(t,e,r)}t.handleError=I,t.getUsableTokens=function(t,e){if(null==t)throw new Es5Error("ErrorType: "+v.SignerUserSDK.ErrorTypes.InvalidArgumentError+" Policy entry not specified");if(!(t=t.POLICY_ACCEPTED_TOKENS))return e;if(null==e)return[];var r=t.split(":");return e.filter(function(t){return-1<r.indexOf(t.getTokenType())})},w.prototype.initialize=function(){if("https:"!==window.location.protocol.toLowerCase()&&"file:"!==window.location.protocol.toLowerCase())throw new Es5Error("ErrorType: "+v.SignerUserSDK.ErrorTypes.SecureEnvError+" SDK cannot be initialized. The SDK cannot run in insecure  environments (i.e. window.location.protocol !== 'https:' && window.location.protocol !== 'file:' )");this.connection.validateUrl(),this.initializeSdk()},w.prototype.isInitialized=function(){return void 0!==this.state},w.prototype.isLoggedIn=function(){return void 0!==this.state&&this.state.hasSessionKey()},w.prototype.free=function(){void 0!==this.state&&(this.state=void 0)},w.prototype.createSession=function(r,e,t){this.createSessionAsync(t).then(function(t){var e=t.tokens,t=t.policies;return r(e,t)},function(t){return I(t,e)})},w.prototype.createSessionAsync=function(S){return __awaiter(this,void 0,void 0,function(){var e,r,n,i,o,s,a,c,u,g,h,l,p,f,y,d=this;return __generator(this,function(t){switch(t.label){case 0:if(this.isInitialized())return this.resetState(),e=crypto.getRandomValues(new Uint8Array(32)),r=Array.from(e),[4,w.generateHelloKey(256)];throw new m(b.ErrorTypes.NotInitializedError,"SDK has not yet been initialized");case 1:if(n=t.sent(),i=Array.from(n),!v.SCK||!v.SCK.Details||!v.SCK.Details.KeySize||0===v.SCK.Details.KeySize)throw new m(b.ErrorTypes.NoSckError,"No SCK has been configured");s=v.Utils.StringUtils.hexToBytes(v.SCK.Details.KeyID),c=v.Utils.StringUtils.hexToBytes(v.SCK.Details.PublicExponent),a=v.Utils.StringUtils.hexToBytes(v.SCK.Details.Modulus),a=new v.ASN1.SubjectPublicKeyInfo([],a,c),t.label=2;case 2:return t.trys.push([2,4,,5]),[4,C.createEncryptedContentForCreateSessionRequest(a,e,n)];case 3:return o=t.sent(),[3,5];case 4:throw c=t.sent(),new m(b.ErrorTypes.CryptoError,"Could not create encrypted content: "+c);case 5:return u=v.Messages.Request.createSessionRequest(s,o,!0,S),[4,new Promise(function(t,r){d.connection.send(u,t,function(t,e){return r(new m(t,e))})})];case 6:return g=t.sent(),g=v.Messages.Response.CreateSession.parse(g),[4,v.SignerUserSDK.Impl.SignerUserSDKObject.decryptHsmResponse(g.encryptedContent,i)];case 7:return l=t.sent(),h=l.hsmNonce,l=l.softwareKey,[4,E(g.softwareEncryptedContent,l)];case 8:return f=t.sent(),f=A.parse(f),p=f.tokens,f=f.policies,y=v.Crypto.SessionKeyUtils.createSessionKey(r,h,i,o,g.encryptedContent),this.state.setSessionKey(y),this.state.setSessionID(g.sessionID),this.state.setSoftwareKey(l),[2,{tokens:p,policies:f}]}})})},w.generateHelloKey=function(n){return __awaiter(this,void 0,void 0,function(){var e,r;return __generator(this,function(t){switch(t.label){case 0:return e={name:"AES-GCM",length:n},[4,crypto.subtle.generateKey(e,!0,["encrypt","decrypt"])];case 1:return(e=t.sent())instanceof CryptoKey?[4,crypto.subtle.exportKey("raw",e)]:[3,3];case 2:return r=t.sent(),[2,new Uint8Array(r)];case 3:throw new m(b.ErrorTypes.UnknownError,"Expected CryptoKey object from SubtleCrypto's generateKey function")}})})},w.decryptHsmResponse=function(n,i){return __awaiter(this,void 0,void 0,function(){var e,r;return __generator(this,function(t){switch(t.label){case 0:return[4,E(n,i)];case 1:return r=t.sent(),r=y(r),e=r.get(f.nonce),r=r.get(f.serverSessionKey),[2,{hsmNonce:e,softwareKey:r}]}})})},w.prototype.getChallenge=function(n,i,e){var o=this;if(this.isInitialized())if(this.state.clearLastChallenge(),"SMS"!==n.getTokenType()&&"OATH-OCRA"!==n.getTokenType())e(b.ErrorTypes.InvalidArgumentError,"Get challenge was called with an unsupported token type: "+n.getTokenType());else try{var t=v.Messages.Tags.Tokens.fromName(n.getTokenType()),r=p.tokenType.encode(t).concat(p.tokenSerial.encode(n.getTokenSerial())),s=S.token.encode(n),a={commandId:v.Messages.CommandIDs.Get_Challenge,hsmContent:r,serverContent:s};this.encryptedSendReceive(a).then(function(t){var e=t.get(f.authenticationChallengeId),t=t.getOptional(f.authenticationChallengeData)||"",r=new v.Messages.AuthenticationChallenge(e,t);o.state.setLastChallenge(n,e,t),i(r)}).catch(function(t){return I(t,e)})}catch(t){I(t,e)}else e(b.ErrorTypes.NotInitializedError,"SDK has not yet been initialized")},w.prototype.escalate=function(s,t,a,c){var e,u,g,h=this;this.isInitialized()?this.state.prepareEscalateSession(s)?(e=crypto.getRandomValues(new Uint8Array(32)),u=Array.from(e),g=v.Utils.StringUtils.string2bytes(t),this.getTokenCredentials(g,s,u,function(t,e){try{var r=h.escalateCommandParts(s,t,e),n=r.serverContent,i=r.hsmContent,o={commandId:v.Messages.CommandIDs.Escalate,hsmContent:i,serverContent:n};h.encryptedSendReceive(o).then(function(){h.state.getSessionAuthLevel()===v.Messages.AuthLevel.TWO_FACTOR&&h.state.setSessionKey(v.Crypto.SessionKeyUtils.deriveNewKey(g,u,h.state.getLastChallengeData(),h.state.getSessionKey())),h.state.clearLastChallenge(),a()}).catch(function(t){return I(t,c)})}catch(t){I(t,c)}},c)):c(b.ErrorTypes.InvalidArgumentError,"Cannot escalate with a token that is inconsistent with the last received challenge."):c(b.ErrorTypes.NotInitializedError,"SDK has not yet been initialized")},w.prototype.escalateCommandParts=function(t,e,r){e=S.token.encode(t).concat(S.ctkId.encode(e),S.ctkEncryption.encode(r));if("OATH-OCRA"===t.getTokenType()||"SMS"===t.getTokenType()){if(!this.state.hasChallenge())throw new m(b.ErrorTypes.IllegalState,"Using challenge token, but there is no challenge data - has GetChallenge been called?");e=e.concat(S.challengeId.encode(this.state.getLastChallengeId())),"OATH-OCRA"===t.getTokenType()&&(e=e.concat(S.challengeData.encode(this.state.getLastChallengeData())))}var n=v.Messages.Tags.Tokens.fromName(t.getTokenType());return{serverContent:e,hsmContent:p.tokenType.encode(n).concat(p.tokenSerial.encode(t.getTokenSerial()),p.tokenCredentials.encode(r))}},w.prototype.escalateAndSign=function(o,t,s,a,c,u){var e,g,h,l=this;s?a?this.isInitialized()?this.state.prepareEscalateSession(o)?(e=crypto.getRandomValues(new Uint8Array(32)),g=Array.from(e),h=v.Utils.StringUtils.string2bytes(t),this.getTokenCredentials(h,o,g,function(t,e){try{var r=l.escalateCommandParts(o,t,e),n=v.Messages.Sign.Request.signCommandParts(s,a),i={commandId:v.Messages.CommandIDs.Escalate_and_Sign,hsmContent:r.hsmContent.concat(n.hsmContent),serverContent:r.serverContent.concat(n.serverContent)};l.encryptedSendReceive(i).then(function(t){l.state.getSessionAuthLevel()!==v.Messages.AuthLevel.NONE&&l.state.setSessionKey(v.Crypto.SessionKeyUtils.deriveNewKey(h,g,l.state.getLastChallengeData(),l.state.getSessionKey())),l.state.clearLastChallenge();try{var e=v.Messages.Sign.Response.extractSignature(t,a,s);c(e)}catch(t){I(t,u)}}).catch(function(t){return I(t,u)})}catch(t){I(t,u)}},u)):u(b.ErrorTypes.InvalidArgumentError,"Cannot escalate with a token that is inconsistent with the last received challenge."):u(b.ErrorTypes.NotInitializedError,"SDK has not yet been initialized"):u(b.ErrorTypes.InvalidArgumentError,"nothing to sign"):u(b.ErrorTypes.InvalidArgumentError,"a key is needed for signing, but none was given")},w.prototype.sign=function(e,r,n,i){if(e)if(r)if(this.isInitialized())try{var t=v.Messages.Sign.Request.signCommandParts(e,r),o=t.serverContent,s=t.hsmContent,a={commandId:v.Messages.CommandIDs.Do_Operation,hsmContent:s,serverContent:o};this.encryptedSendReceive(a).then(function(t){t=v.Messages.Sign.Response.extractSignature(t,r,e);n(t)}).catch(function(t){return I(t,i)})}catch(t){I(t,i)}else i(b.ErrorTypes.NotInitializedError,"SDK has not yet been initialized");else i(b.ErrorTypes.InvalidArgumentError,"nothing to sign");else i(b.ErrorTypes.InvalidArgumentError,"a key is needed for signing, but none was given")},w.prototype.logoff=function(t,e){var r,n=this;this.isInitialized()?(r={commandId:v.Messages.CommandIDs.Logoff,hsmContent:[],serverContent:[]},this.encryptedSendReceive(r).then(function(){n.resetState(),t()}).catch(function(t){return I(t,e)})):e(b.ErrorTypes.NotInitializedError,"SDK has not yet been initialized")},w.prototype.noop=function(t,e){var r;this.isInitialized()?this.isLoggedIn()?(r={commandId:v.Messages.CommandIDs.Noop,hsmContent:[],serverContent:[]},this.encryptedSendReceive(r).then(function(){try{t()}catch(t){I(t,e)}}).catch(function(t){return I(t,e)})):e(b.ErrorTypes.IllegalState,"Session has not been created"):e(b.ErrorTypes.NotInitializedError,"SDK has not yet been initialized")},w.prototype.initializeSdk=function(){void 0!==this.state&&this.free(),this.state=new v.Utils.StateHandler.StateObject,this.state.setSessionAuthLevel(v.Messages.AuthLevel.NONE)},w.prototype.resetState=function(){this.state=new v.Utils.StateHandler.StateObject},w.prototype.encryptedSendReceive=function(g){return __awaiter(this,void 0,void 0,function(){var e,r,n,i,o,s,a,c,u=this;return __generator(this,function(t){switch(t.label){case 0:if(this.isLoggedIn())return r=p.commandId.encode(g.commandId),n=p.sequenceNumber.encode(this.state.getSequenceNumber()),[4,T(r.concat(n,g.hsmContent),this.state.getSessionKey())];throw new m(b.ErrorTypes.IllegalState,"Session has not been created");case 1:return e=t.sent(),r=S.commandId.encode(g.commandId),[4,T(r.concat(g.serverContent),this.state.getSoftwareKey())];case 2:return n=t.sent(),i=v.Messages.createUserRequest(this.state.getSessionID(),e,n),[4,new Promise(function(t,r){u.connection.send(i,t,function(t,e){return r(new m(t,e))})})];case 3:if(s=t.sent(),s=h(s,"RENC"),o=d.errorCode.get(s),s=d.hsmEncryption.getOptional(s),o===v.Messages.SignerErrorCodes.FORCED_LOGOFF&&!s)return this.resetState(),[2,l()];if(s&&0!==s.length)return[4,E(s,this.state.getSessionKey())];throw new m(b.ErrorTypes.InvalidResponseError,"Encrypted content was missing from response");case 4:if(s=t.sent(),a=y(s),this.verifySequenceNumber(a),c=a.get(f.returnCode),o===v.Messages.SignerErrorCodes.FORCED_LOGOFF){if(this.resetState(),c!==v.Messages.SignerErrorCodes.OK)throw new m(b.ErrorTypes.SignerError,"Signer returned error code: "+v.Messages.SignerErrorCodes.getError(c),c);return[2,a]}if(o!==v.Messages.SignerErrorCodes.OK)throw new m(b.ErrorTypes.SignerError,"Signer returned error code: "+v.Messages.SignerErrorCodes.getError(o),o);if(c===v.Messages.SignerErrorCodes.AUTHENTICATION_FAILED_FORCED_LOGOFF&&this.resetState(),c!==v.Messages.SignerErrorCodes.OK)throw new m(b.ErrorTypes.SignerError,"Signer returned error code: "+v.Messages.SignerErrorCodes.getError(c),c);return this.state.setSessionAuthLevel(a.get(f.sessionAuthLevel)),[2,a]}})})},w.prototype.verifySequenceNumber=function(t){if(t.get(f.sequenceNumber)!==this.state.getSequenceNumber()+1)throw new m(b.ErrorTypes.InvalidResponseError,"Invalid sequence number found in response");this.state.incrementSequenceNumber()},w.prototype.getTokenCredentials=function(t,e,r,n,i){try{if(!v.CTK||!v.CTK.Details||!v.CTK.Details.KeySize||0===v.CTK.Details.KeySize)return void i(b.ErrorTypes.NoCtkError,"No CTK has been configured");var o=v.Utils.StringUtils.hexToBytes(v.CTK.Details.KeyID),s=v.Utils.StringUtils.hexToBytes(v.CTK.Details.PublicExponent),a=v.Utils.StringUtils.hexToBytes(v.CTK.Details.Modulus),c=new v.ASN1.SubjectPublicKeyInfo([],a,s),u=t.concat(r);C.encryptRsaWithOaep(c,new Uint8Array(u),function(t){return n(o,t)},function(t){return i(b.ErrorTypes.CryptoError,"RSA encryption failed: "+t)})}catch(t){I(t,i)}},t.SignerUserSDKObject=w})((b=v.SignerUserSDK||(v.SignerUserSDK={})).Impl||(b.Impl={}))}(Cryptomathic=Cryptomathic||{}),function(n){!function(t){function e(t,e,r){this.impl=new n.SignerUserSDK.Impl.SignerUserSDKObject(t,e,r)}e.prototype.initialize=function(){this.impl.initialize()},e.prototype.isInitialized=function(){return this.impl.isInitialized()},e.prototype.free=function(){this.impl.free()},e.prototype.createSession=function(t,e,r){this.impl.createSession(t,e,r)},e.prototype.getChallenge=function(t,e,r){this.impl.getChallenge(t,e,r)},e.prototype.getUsableTokens=function(t,e){return n.SignerUserSDK.Impl.getUsableTokens(t,e)},e.prototype.escalate=function(t,e,r,n){this.impl.escalate(t,e,r,n)},e.prototype.escalateAndSign=function(t,e,r,n,i,o){this.impl.escalateAndSign(t,e,r,n,i,o)},e.prototype.sign=function(t,e,r,n){this.impl.sign(t,e,r,n)},e.prototype.logoff=function(t,e){this.impl.logoff(t,e)},e.prototype.noop=function(t,e){this.impl.noop(t,e)},t.SDK=e}(n.SignerUserSDK||(n.SignerUserSDK={}))}(Cryptomathic=Cryptomathic||{}),function(a){!function(t){var o=a.Error.CrmError,s=a.SignerUserSDK.ErrorTypes;function r(t,e){if(t.length<2)throw new o(s.SerializationError,"Supplied data does not contain a valid encoding");this.tag=t[e+0];var r=function(t,e){{if(128===t[e])throw new o(s.SerializationError,"Indefinite length not supported");return 128==(128&t[e])?1+(127&t[e]):1}}(t,e+1),n=function(t,e,r){if(t.length-e<r)throw new o(s.SerializationError,"Data length indicates it is longer than supplied data");{if(1===r)return 127&t[e];for(var n=0,i=1;i<r;i++)n=(n<<8)+t[i+e];return n}}(t,e+1,r);if(t.length<1+r+n)throw new o(s.SerializationError,"Supplied data does not contain a valid encoding");this.bytes=new Array(n);for(var i=0;i<n;i++)this.bytes[i]=t[e+1+r+i];this.read=1+r+n}r.decode=function(t,e){return new r(t,e)},r.prototype.getBytes=function(){return this.bytes},r.prototype.getTag=function(){return this.tag},r.prototype.getRead=function(){return this.read},r.prototype.checkValue=function(t,e){var r=a.Utils.StringUtils.hexToBytes(t);if(r.length!==this.bytes.length)throw new o(s.SerializationError,"ASN1SubObject is invalid: "+e);for(var n=t.length,i=0;i<n;i++)if(r[i]!==this.bytes[i])throw new o(s.SerializationError,"ASN1SubObject is invalid: "+e)},t.ASN1SubObject=r}(a.ASN1||(a.ASN1={}))}(Cryptomathic=Cryptomathic||{}),function(t){var s,a,i,c,u;s=t.ASN1||(t.ASN1={}),a=s.ASN1Util||(s.ASN1Util={}),c=t.Error.CrmError,u=t.SignerUserSDK.ErrorTypes,(t=i=a.TagClasses||(a.TagClasses={}))[t.UNIVERSAL=0]="UNIVERSAL",t[t.APPLICATION=64]="APPLICATION",t[t.CONTEXT_SPECIFIC=128]="CONTEXT_SPECIFIC",t[t.PRIVATE=192]="PRIVATE",a.encodeLength=function(t){if(t<0)throw new c(u.InvalidArgumentError,"Cannot encode negative length");if(t<=127)return[t];for(var e=[];0<t;)e.unshift(t%256),t=t/256|0;return e.unshift(128|e.length),e},a.encodeTag=function(t,e,r){if(t!==i.UNIVERSAL&&t!==i.APPLICATION&&t!==i.CONTEXT_SPECIFIC&&t!==i.PRIVATE)throw new c(u.InvalidArgumentError,"Cannot encode unknown class type: "+t);if(e<0)throw new c(u.InvalidArgumentError,"Cannot encode negative tag: "+e);if(r=r?32:0,e<=30)return[t|r|e];for(var n=[t|r|31];0<e;)n.unshift(e%128|128),e=e/128|0;return n[n.length-1]^=128,n.unshift(t|r|31),n},a.encodePrimitiveTag=function(t,e){return a.encodeTag(t,e,!1)},a.encodeConstructedTag=function(t,e){return a.encodeTag(t,e,!0)},a.prependExplicitTag=function(t,e,r){return t=t.encode(),e=a.encodeConstructedTag(e,r).concat(a.encodeLength(t.length)),new s.Asn1Literal(e.concat(t))},a.makeTagImplicit=function(t,e,r){var n,i=t.encode();if(0===i.length)throw new c(u.InvalidArgumentError,"Encoding too short for tag");if(31==(31&i[0])){for(var o=1;1==(128&i[o++]););n=i.slice(++o)}else n=i.slice(1);return new s.Asn1Literal(a.encodeConstructedTag(e,r).concat(n))}}(Cryptomathic=Cryptomathic||{}),function(r){var t,e,n,i;function o(t,e){void 0===e&&(e=r.ASN1.Asn1Constants.nullAlgorithmIdentifierParameters),this.algorithm=t,this.parameters=e}t=r.ASN1||(r.ASN1={}),e=r.Error.CrmError,n=r.SignerUserSDK.ErrorTypes,o.prototype.encode=function(){if(!this.algorithm)throw new e(n.IllegalState,"Error while encoding AlgorithmIdentifier object, algorithm is not set");if(this.parameters)return(new r.ASN1.Sequence).push(this.algorithm).push(this.parameters).encode();throw new e(n.IllegalState,"Error while encoding AlgorithmIdentifier object, parameters is not set")},i=o,t.AlgorithmIdentifier=i,t.createDigestAlgorithmIdentifier=function(t){if("SHA256/RSA"===t||"SHA256withRSA"===t)return new i(r.ASN1.Asn1Constants.sha256Oid);if("SHA384/RSA"===t||"SHA384withRSA"===t)return new i(r.ASN1.Asn1Constants.sha384Oid);if("SHA512/RSA"===t||"SHA512withRSA"===t)return new i(r.ASN1.Asn1Constants.sha512Oid);throw new e(n.IllegalState,"Unknown algorithm "+t)},t.createSignatureAlgorithmIdentifier=function(t){if("SHA256/RSA"===t||"SHA256withRSA"===t||"SHA384/RSA"===t||"SHA384withRSA"===t||"SHA512/RSA"===t||"SHA512withRSA"===t)return new i(r.ASN1.Asn1Constants.rsaEncryptionOid);throw new e(n.IllegalState,"Unknown algorithm "+t)}}(Cryptomathic=Cryptomathic||{}),function(r){!function(t){function e(t){if(127<t||t<0)throw new r.Error.CrmError(r.SignerUserSDK.ErrorTypes.IllegalState,"Error while encoding Asn1Integer object: '"+t+"' is not a supported value.");this.encoding=[t]}e.prototype.encode=function(){return t.ASN1Util.encodePrimitiveTag(t.ASN1Util.TagClasses.UNIVERSAL,2).concat(t.ASN1Util.encodeLength(this.encoding.length).concat(this.encoding))},t.Asn1Integer=e}(r.ASN1||(r.ASN1={}))}(Cryptomathic=Cryptomathic||{}),function(t){!function(t){function e(t){this.encoding=t}e.prototype.encode=function(){return this.encoding},t.Asn1Literal=e}(t.ASN1||(t.ASN1={}))}(Cryptomathic=Cryptomathic||{}),function(t){(t=t.ASN1||(t.ASN1={})).ByteArrayConstants=Object.freeze({sha256Oid:[6,9,96,134,72,1,101,3,4,2,1],sha384Oid:[6,9,96,134,72,1,101,3,4,2,2],sha512Oid:[6,9,96,134,72,1,101,3,4,2,3],signRsaRaw:[6,9,42,134,72,134,247,13,1,1,1],signRsaPss:[6,9,42,134,72,134,247,13,1,1,10],signRsaPkcs1Sha256:[6,9,42,134,72,134,247,13,1,1,11],signRsaPkcs1Sha384:[6,9,42,134,72,134,247,13,1,1,12],signRsaPkcs1Sha512:[6,9,42,134,72,134,247,13,1,1,13],signEcdsaSha256:[6,8,42,134,72,206,61,4,3,2],signEcdsaSha384:[6,8,42,134,72,206,61,4,3,3],signEcdsaSha512:[6,8,42,134,72,206,61,4,3,4]}),t.Asn1Constants=Object.freeze({rsaEncryptionOid:new t.Asn1Literal([6,9,42,134,72,134,247,13,1,1,1]),nullAlgorithmIdentifierParameters:new t.Asn1Literal([5,0]),pkcs7SignedData:new t.Asn1Literal([6,9,42,134,72,134,247,13,1,7,2]),pkcs7Data:new t.Asn1Literal([6,9,42,134,72,134,247,13,1,7,1]),sha256Oid:new t.Asn1Literal(t.ByteArrayConstants.sha256Oid),sha384Oid:new t.Asn1Literal(t.ByteArrayConstants.sha384Oid),sha512Oid:new t.Asn1Literal(t.ByteArrayConstants.sha512Oid),signRsaPkcs1Sha256:new t.Asn1Literal(t.ByteArrayConstants.signRsaPkcs1Sha256),signRsaPkcs1Sha384:new t.Asn1Literal(t.ByteArrayConstants.signRsaPkcs1Sha384),signRsaPkcs1Sha512:new t.Asn1Literal(t.ByteArrayConstants.signRsaPkcs1Sha512),rsaSsaPssOid:new t.Asn1Literal(t.ByteArrayConstants.signRsaPss),mgf1Oid:new t.Asn1Literal([6,9,42,134,72,134,247,13,1,1,8])})}(Cryptomathic=Cryptomathic||{}),function(t){!function(r){function t(t,e){this.type=t,this.content=e}t.prototype.encode=function(){var t,e=(new r.Sequence).push(this.type);return this.content&&(t=r.ASN1Util.prependExplicitTag(this.content,r.ASN1Util.TagClasses.CONTEXT_SPECIFIC,0),e.push(t)),e.encode()},r.ContentInfo=t}(t.ASN1||(t.ASN1={}))}(Cryptomathic=Cryptomathic||{}),function(t){!function(r){function t(t,e){this.type=t,this.content=e}t.prototype.encode=function(){var t,e=(new r.Sequence).push(this.type);return this.content&&(t=r.ASN1Util.prependExplicitTag(this.content,r.ASN1Util.TagClasses.CONTEXT_SPECIFIC,0),e.push(t)),e.encode()},r.EncapsulatedContentInfo=t}(t.ASN1||(t.ASN1={}))}(Cryptomathic=Cryptomathic||{}),function(t){!function(e){function t(){this.content=[]}t.prototype.push=function(t,e){return this.content.push({asn1Object:t,index:e}),this},t.prototype.wrapContentInExplicitTags=function(){var t=this.content.map(function(t){return e.ASN1Util.prependExplicitTag(t.asn1Object,e.ASN1Util.TagClasses.CONTEXT_SPECIFIC,t.index)});return new e.Sequence(t)},e.IndexedSequence=t}(t.ASN1||(t.ASN1={}))}(Cryptomathic=Cryptomathic||{}),function(r){!function(t){function e(t,e){this.issuer=new r.ASN1.Asn1Literal(t),this.serial=new r.ASN1.Asn1Literal(e)}e.prototype.encode=function(){return(new t.Sequence).push(this.issuer).push(this.serial).encode()},t.IssuerAndSerialNumber=e}(r.ASN1||(r.ASN1={}))}(Cryptomathic=Cryptomathic||{}),function(t){!function(t){function e(t){this.bytes=t}e.prototype.encode=function(){return t.ASN1Util.encodePrimitiveTag(t.ASN1Util.TagClasses.UNIVERSAL,4).concat(t.ASN1Util.encodeLength(this.bytes.length).concat(this.bytes))},t.OctetString=e}(t.ASN1||(t.ASN1={}))}(Cryptomathic=Cryptomathic||{}),function(a){var c,t;function o(t,e,r,n){s=t,e=e,o=n,(i=new a.ASN1.SignerInfo).setVersion(new a.ASN1.Asn1Integer(1)),i.setSignerIdentifier(s),s=c.createDigestAlgorithmIdentifier(o.signatureId),i.setDigestAlgorithm(s),i.setSignatureAlgorithm(o.signatureAlgorithmIdentifier),s=new a.ASN1.OctetString(e),i.setSignatureValue(s);var i,o=i,s=(e=n,e=c.createDigestAlgorithmIdentifier(n.signatureId),new c.Set(e)),n=(i=r)?new c.EncapsulatedContentInfo(a.ASN1.Asn1Constants.pkcs7Data,new a.ASN1.OctetString(i)):new c.EncapsulatedContentInfo(a.ASN1.Asn1Constants.pkcs7Data),s=(e=t,r=o,i=s,t=n,(o=new a.ASN1.SignedData).setVersion(new a.ASN1.Asn1Integer(1)),o.setEncodedCertificate(e),o.setSignerInfo(r),o.setDigestAlgorithms(i),o.setEncapsulatedContentInfo(t),o);return new a.ASN1.ContentInfo(a.ASN1.Asn1Constants.pkcs7SignedData,s).encode()}c=a.ASN1||(a.ASN1={}),(t=c.PKCS7||(c.PKCS7={})).createPkcs7SignedMessage=function(t,e,r,n){return n=a.Crypto.Digest.toAlgorithm(n),o(t,e,r,{signatureId:t=n.SIGNATURE_ID,signatureAlgorithmIdentifier:c.createSignatureAlgorithmIdentifier(t)})},t.createPssPkcs7SignedMessage=function(t,e,r,n,i){return n=a.Crypto.Digest.toAlgorithm(n),i=i?n.DIGEST_SIZE:0,o(t,e,r,{signatureId:t=n.SIGNATURE_ID,signatureAlgorithmIdentifier:c.encodePssAlgorithmId(t,i)})}}(Cryptomathic=Cryptomathic||{}),function(n){var i,o;function t(t,e,r){this.asn1HashAlgorithm=t,this.asn1Mgf=e,this.asn1SaltLength=r}function r(t,e){var t=i.createDigestAlgorithmIdentifier(t),r=new i.AlgorithmIdentifier(n.ASN1.Asn1Constants.mgf1Oid,t),e=new n.ASN1.Asn1Integer(e);return new o(t,r,e)}i=n.ASN1||(n.ASN1={}),t.prototype.encode=function(){var t=new n.ASN1.IndexedSequence;return(t=(t=(t=t.push(this.asn1HashAlgorithm,0)).push(this.asn1Mgf,1)).push(this.asn1SaltLength,2)).wrapContentInExplicitTags().encode()},o=t,i.encodePssAlgorithmId=function(t,e){return new i.AlgorithmIdentifier(n.ASN1.Asn1Constants.rsaSsaPssOid,r(t,e))},i.encodePssParameters=r}(Cryptomathic=Cryptomathic||{}),function(r){!function(e){function t(t){this.content=t=void 0===t?[]:t}t.prototype.push=function(t){return this.content.push(t),this},t.prototype.encode=function(){var t=this.content.reduce(function(t,e){return t.concat(e.encode())},[]);return r.ASN1.ASN1Util.encodeConstructedTag(e.ASN1Util.TagClasses.UNIVERSAL,16).concat(r.ASN1.ASN1Util.encodeLength(t.length).concat(t))},e.Sequence=t}(r.ASN1||(r.ASN1={}))}(Cryptomathic=Cryptomathic||{}),function(n){!function(e){var r=n.SignerUserSDK.ErrorTypes;function t(t){this.content=[],t&&this.content.push(t)}t.prototype.push=function(t){return this.content.push(t),this},t.prototype.encode=function(){if(0===this.content.length)throw new n.Error.CrmError(r.IllegalState,"Error: cannot encode empty sequence.");var t=this.content.reduce(function(t,e){return t.concat(e.encode())},[]);return e.ASN1Util.encodeConstructedTag(e.ASN1Util.TagClasses.UNIVERSAL,17).concat(e.ASN1Util.encodeLength(t.length).concat(t))},e.Set=t}(n.ASN1||(n.ASN1={}))}(Cryptomathic=Cryptomathic||{}),function(i){!function(r){var n=i.SignerUserSDK.ErrorTypes;function t(){}t.prototype.setVersion=function(t){return this.version=t,this},t.prototype.setDigestAlgorithms=function(t){return this.digestAlgorithms=t,this},t.prototype.setEncapsulatedContentInfo=function(t){return this.encapsulatedContentInfo=t,this},t.prototype.setEncodedCertificate=function(t){return this.certificate=new r.Asn1Literal(t),this},t.prototype.setSignerInfo=function(t){return this.signerInfo=t,this},t.prototype.encode=function(){if(!this.version)throw new i.Error.CrmError(n.IllegalState,"Error while encoding SignedData object, version is not set");if(!this.digestAlgorithms)throw new i.Error.CrmError(n.IllegalState,"Error while encoding SignedData object, digestAlgorithms is not set");if(!this.encapsulatedContentInfo)throw new i.Error.CrmError(n.IllegalState,"Error while encoding SignedData object, encapsulatedContentInfo is not set");if(!this.certificate)throw new i.Error.CrmError(n.IllegalState,"Error while encoding SignedData object, certificate is not set");if(!this.signerInfo)throw new i.Error.CrmError(n.IllegalState,"Error while encoding SignedData object, signerInfo is not set");var t=new r.Set(this.certificate),t=r.ASN1Util.makeTagImplicit(t,r.ASN1Util.TagClasses.CONTEXT_SPECIFIC,0),e=new r.Set(this.signerInfo);return(new r.Sequence).push(this.version).push(this.digestAlgorithms).push(this.encapsulatedContentInfo).push(t).push(e).encode()},r.SignedData=t}(i.ASN1||(i.ASN1={}))}(Cryptomathic=Cryptomathic||{}),function(i){!function(t){var e=i.Error.CrmError,r=i.SignerUserSDK.ErrorTypes;function n(){this.version=null,this.signerIdentifier=null,this.digestAlgorithm=null,this.signatureAlgorithm=null,this.signatureValue=null}n.prototype.setVersion=function(t){return this.version=t,this},n.prototype.setSignerIdentifier=function(t){t=i.ASN1.X509.readIssuerAndSerial(t);return this.signerIdentifier=new i.ASN1.IssuerAndSerialNumber(t.issuer,t.serial),this},n.prototype.setDigestAlgorithm=function(t){return this.digestAlgorithm=t,this},n.prototype.setSignatureAlgorithm=function(t){return this.signatureAlgorithm=t,this},n.prototype.setSignatureValue=function(t){return this.signatureValue=t,this},n.prototype.encode=function(){if(null===this.version)throw new e(r.IllegalState,"Error while encoding SignerInfo object, version is not set.");if(null===this.signerIdentifier)throw new e(r.IllegalState,"Error while encoding SignerInfo object, issuerAndSerialNumber is not set.");if(null===this.digestAlgorithm)throw new e(r.IllegalState,"Error while encoding SignerInfo object, digestAlgorithm is not set.");if(null===this.signatureAlgorithm)throw new e(r.IllegalState,"Error while encoding SignerInfo object, signatureAlgorithm is not set.");if(null===this.signatureValue)throw new e(r.IllegalState,"Error while encoding SignerInfo object, signatureValue is not set.");return(new t.Sequence).push(this.version).push(this.signerIdentifier).push(this.digestAlgorithm).push(this.signatureAlgorithm).push(this.signatureValue).encode()},t.SignerInfo=n}(i.ASN1||(i.ASN1={}))}(Cryptomathic=Cryptomathic||{}),function(t){!function(i){var o=t.Error.CrmError,s=t.SignerUserSDK.ErrorTypes;function n(t,e,r){this.encoded=t,this.modulus=function(t){0===t[0]&&(t=t.slice(1,t.length));return t}(e),this.publicExponent=r}function a(t,e,r,n){t=i.ASN1SubObject.decode(t,e);if(t.getTag()!==r)throw new o(s.SerializationError,"Public key is not in right format. "+n);return t}n.prototype.getModulus=function(){return this.modulus},n.prototype.getPublicExponent=function(){return this.publicExponent},n.prototype.getEncoded=function(){return this.encoded},n.createFromEncoded=function(t){var t=t.slice(0),e=a(t,0,48,"Sequence tag is incorrect"),r=a(e.getBytes(),0,48,"The AlgorithmIdentifier tag is incorrect"),e=(r.checkValue("06092a864886f70d0101010500","AlgorithmIdentifier value is incorrect"),a(e.getBytes(),r.getRead(),3,"The BitString tag is incorrect")),r=a(e.getBytes(),1,48,"The PublicKey tag is incorrect"),e=a(r.getBytes(),0,2,"Modulus tag is incorrect"),r=a(r.getBytes(),e.getRead(),2,"Exponent tag is incorrect");return new n(t,e.getBytes(),r.getBytes())},i.SubjectPublicKeyInfo=n}(t.ASN1||(t.ASN1={}))}(Cryptomathic=Cryptomathic||{}),function(t){var e,i,o;function n(t){var e=t.bytes,t=t.offset,r=e[t];if(r<=127)return{length:r,encodingLength:1,totalLength:1+r};r&=127;if(r>=e.length+t)throw new i(o.CryptoError,"Incorrect length encoding in X.509");e=function(t,e,r){for(var n=0,i=0;i<r;++i)0<i&&(n*=256),n+=t[i+e];return n}(e,t+1,r);return{length:e,encodingLength:1+r,totalLength:1+r+e}}function r(t,e){var r=t.bytes,n=t.offset;if(n+1>=r.length)throw new i(o.CryptoError,"Tag "+e+" expected past end of encoding in X.509");if(r[n]!==e)throw new i(o.CryptoError,"Expected tag "+e+" but found "+r[0]);t.offset++}function s(t){var e=n(t);return t.offset+=e.encodingLength,e.length}function a(t,e){r(t,e),s(t)}function c(t,e){r(t,e);e=s(t);if(t.offset+e>=t.bytes.length)throw new i(o.CryptoError,"Attempted to read past end of encoding in X.509");t.offset+=e}function u(t){var e=[t.bytes[t.offset++]],r=n(t);if(t.offset+r.totalLength>t.bytes.length)throw new i(o.CryptoError,"Attempted to read past end of encoding in X.509");return e=e.concat(t.bytes.slice(t.offset,t.offset+r.totalLength)),t.offset+=r.totalLength,e}e=(e=t.ASN1||(t.ASN1={})).X509||(e.X509={}),i=t.Error.CrmError,o=t.SignerUserSDK.ErrorTypes,e.readIssuerAndSerial=function(t){a(t={bytes:t,offset:0},48),a(t,48),160===t.bytes[t.offset]&&c(t,160);var e=u(t);return c(t,48),{serial:e,issuer:u(t)}}}(Cryptomathic=Cryptomathic||{}),function(a){!function(t){var e=a.Error.CrmError,o=a.SignerUserSDK.ErrorTypes;function s(t,e,r){this.url=t,this.timeout=e,this.connectionUpdateHook=r}s.prototype.getUrl=function(){return this.url},s.prototype.getTimeout=function(){return this.timeout},s.prototype.validateUrl=function(){if(!this.url||"string"!=typeof this.url)throw new e(o.InvalidArgumentError,"Invalid url, must be non-empty string");if(!this.timeout||"number"!=typeof this.timeout||Math.floor(this.timeout)!==this.timeout||this.timeout<0)throw new e(o.InvalidArgumentError,"Invalid timeout, must be a positive integer");if(s.isAbsoluteAndNonSecure(this.url))throw new e(o.SecureEnvError,"SDK cannot be initialized. Host URL '"+this.url+"', must be relative or secure absolute (https://)")},s.isAbsoluteAndNonSecure=function(t){var e;try{e=new URL(t)}catch(t){return!1}return"https:"!==e.protocol.toLowerCase()},s.prototype.send=function(t,e,r){function n(t){return function(){r(o.ConnectionError,"Failed to send request to Signer: "+t)}}var i=new XMLHttpRequest,t=(i.open("POST",this.url),i.withCredentials=!0,i.timeout=this.timeout,i.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),this.connectionUpdateHook&&this.connectionUpdateHook(i),i.onload=function(){s.handleResponse(i,e,n("Communication failed with status "+i.status+" "+i.statusText))},i.onerror=n("Communication failed with status "+i.status+" "+i.statusText),i.ontimeout=n("Request timed out"),a.Utils.Base64.encode(t));i.send(t)},s.handleResponse=function(t,e,r){200===t.status?e(a.Utils.Base64.decode(t.responseText)):r()},t.SignerConnection=s}(a.Comm||(a.Comm={}))}(Cryptomathic=Cryptomathic||{}),function(e){var t;(t=(t=e.Crypto||(e.Crypto={})).Digest||(t.Digest={})).toAlgorithm=function(t){switch(t){case e.Crypto.Digest.SHA256:return e.Crypto.SHA256;case e.Crypto.Digest.SHA384:return e.Crypto.SHA384;case e.Crypto.Digest.SHA512:return e.Crypto.SHA512;default:throw new e.Error.CrmError(e.SignerUserSDK.ErrorTypes.InvalidArgumentError,"Digest must be one of Cryptomathic.Crypto.Digest")}},t.toAsn1Oid=function(t){switch(t){case e.Crypto.Digest.SHA256:return e.ASN1.Asn1Constants.sha256Oid;case e.Crypto.Digest.SHA384:return e.ASN1.Asn1Constants.sha384Oid;case e.Crypto.Digest.SHA512:return e.ASN1.Asn1Constants.sha512Oid;default:throw new e.Error.CrmError(e.SignerUserSDK.ErrorTypes.InvalidArgumentError,"Digest must be one of Cryptomathic.Crypto.Digest")}}}(Cryptomathic=Cryptomathic||{}),function(t){var r;function e(t){t=Number(t>>>0).toString(16);return"00000000".substr(0,8-t.length)+t}function n(t){t>>>=0;return[t>>>24&255,t>>>16&255,t>>>8&255,255&t]}function i(t){return(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3]>>>0}function o(t){return n(t[0]).concat(n(t[1]))}t=t.Crypto||(t.Crypto={}),(r=t.Int64||(t.Int64={})).fromBytes=function(t){return[i(t.slice(0,4)),i(t.slice(4,8))]},r.toBytes=o,r.fromInts=function(t,e){return[t,e]},r.fromNumber=function(t){return[Math.floor(t/4294967296),t%4294967296]},r.xor=function(t,e){return[t[0]^e[0],t[1]^e[1]]},r.xors=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=t[0][1],n=t[0][0],i=1;i<t.length;i++)r^=t[i][1],n^=t[i][0];return[n,r]},r.and=function(t,e){return[t[0]&e[0],t[1]&e[1]]},r.or=function(t,e){return[t[0]|e[0],t[1]|e[1]]},r.not=function(t){return[~t[0],~t[1]]},r.add=function(t,e){var r=(t[1]>>>0)+(e[1]>>>0),t=(t[0]>>>0)+(e[0]>>>0);return[t+=Math.floor(r/4294967296),r]},r.sum=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=t[0][1]>>>0,n=t[0][0]>>>0,i=1;i<t.length;i++)n+=t[i][0]>>>0,r+=t[i][1]>>>0;return[n+=Math.floor(r/4294967296),r]},r.shr=function(t,e){var r;return 0===(e&=63)?t:e<32?(r=t[0]<<32-e,[t[0]>>>e,r|t[1]>>>e]):[0,t[0]>>>e-32]},r.shr_low=function(t,e){return 0===(e&=63)?t[1]:e<32?t[0]<<32-e|t[1]>>>e:t[0]>>>e-32},r.shr_high=function(t,e){return 0===(e&=63)?t[0]:e<32?t[0]>>>e:0},r.shl=function(t,e){var r;return 0===(e&=63)?t:e<32?(r=t[1]>>>32-e,[t[0]<<e|r,t[1]<<e]):[t[1]<<e-32,0]},r.rotr=function(t,e){return 0===(e&=63)?t:r.or(r.shr(t,e),r.shl(t,64-e))},r.rotr_low=function(t,e){return 0===(e&=63)?t[1]:e<32?t[1]>>>e^t[0]<<32-e:r.rotr_high(t,e-32)},r.rotr_high=function(t,e){return 0===(e&=63)?t[0]:e<32?t[0]>>>e^t[1]<<32-e:r.rotr_low(t,e-32)},r.rotl=function(t,e){return 0===(e&=63)?t:r.or(r.shl(t,e),r.shr(t,64-e))},r.toHex=function(t){return e(t[0])+e(t[1])},r.convertInt64ArrayToByteArray=function(t){return t.reduce(function(t,e){return t.concat(o(e))},[])}}(Cryptomathic=Cryptomathic||{}),function(n){!function(o){var e=n.Error.CrmError,r=n.SignerUserSDK.ErrorTypes;function t(t){this.blocksizeInBytes=128,this.int64SizeInBytes=8,this.blockLengthInInt64s=this.blocksizeInBytes/this.int64SizeInBytes,this.lengthFieldSizeBytes=16,this.messageBytes=t,this.blockLengthInInt64s=this.blocksizeInBytes/this.int64SizeInBytes,this.currentBlock=0,this.fullBlocks=Math.floor(t.length/this.blocksizeInBytes),this.tail=this.makeTail(),this.tailBlocks=this.tail.length/this.blocksizeInBytes}t.prototype.makeTail=function(){var t=this.messageBytes.slice(this.fullBlocks*this.blocksizeInBytes),e=this.blocksizeInBytes-t.length-this.lengthFieldSizeBytes-1,r=(e<0&&(e+=this.blocksizeInBytes),o.Int64.shl(o.Int64.fromNumber(this.messageBytes.length),3)),r=n.Utils.ByteArrayUtils.emptyArray(8).concat(o.Int64.toBytes(r));return n.Utils.ByteArrayUtils.convertToNumberArray(t).concat(128).concat(n.Utils.ByteArrayUtils.emptyArray(e),r)},t.prototype.hasNext=function(){return this.currentBlock<this.fullBlocks+this.tailBlocks},t.prototype.makeBlock=function(t){for(var e=0,r=new Array(this.blockLengthInInt64s),n=0;n<this.blockLengthInInt64s;n++){var i=e+this.int64SizeInBytes;r[n]=o.Int64.fromBytes(t.slice(e,i)),e=i}return r},t.prototype.getNext=function(){var t;if(this.currentBlock<this.fullBlocks)return t=this.currentBlock*this.blocksizeInBytes,this.currentBlock++,this.makeBlock(this.messageBytes.slice(t,t+this.blocksizeInBytes));if(this.currentBlock-this.fullBlocks<this.tailBlocks)return t=(this.currentBlock-this.fullBlocks)*this.blocksizeInBytes,this.currentBlock++,this.makeBlock(this.tail.slice(t,t+this.blocksizeInBytes));throw new e(r.IllegalState,"Trying to read more input to Hashfunction than is available")},o.MessageBlockStream=t}(n.Crypto||(n.Crypto={}))}(Cryptomathic=Cryptomathic||{}),function(d){var t,i;function e(){}function o(t,e,r,n){if(4294967295<r.length)throw new d.Error.CrmError(d.SignerUserSDK.ErrorTypes.InvalidArgumentError,"Label too long");var i=d.Crypto.SHA256.hash(r),o=e.length,r=t-o-2*i.length-2;if(r<0)throw new d.Error.CrmError(d.SignerUserSDK.ErrorTypes.InvalidArgumentError,"Message too long");for(var s=new Uint8Array(r),a=0;a<s.length;a++)s[a]=0;var c=new Uint8Array(i.length+s.length+1+o),u=0;for(a=0;a<i.length;a++)c[u++]=i[a];for(a=0;a<s.length;a++)c[u++]=s[a];for(c[u++]=1,a=0;a<o;a++)c[u++]=e[a];var g=n.generateRandom(32),h=S(g,t-32-1),l=new Uint8Array(h.length);for(a=0;a<h.length;a++)l[a]=c[a]^h[a];var p=S(l,32),f=new Uint8Array(32);for(a=0;a<f.length;a++)f[a]=g[a]^p[a];var y=new Uint8Array(1+f.length+l.length),u=0;for(a=y[u++]=0;a<f.length;a++)y[u++]=f[a];for(a=0;a<l.length;a++)y[u++]=l[a];return y}function S(t,e){return r(d.Crypto.SHA256,t,e)}function r(t,e,r){for(var n=new Uint8Array(e.length+4),i=new Uint8Array(r),o=0;o<e.length;o++)n[o]=e[o];for(var s=0,o=0;s<r;o++){n[e.length]=o>>24&255,n[e.length+1]=o>>16&255,n[e.length+2]=o>>8&255,n[e.length+3]=255&o;for(var a=t.hash(n),c=0;c<t.DIGEST_SIZE&&s<r;c++,s++)i[s]=a[c]}return i}t=(t=d.Crypto||(d.Crypto={})).OAEP||(t.OAEP={}),e.prototype.generateRandom=function(t){t=new Uint8Array(t);return crypto.getRandomValues(t)},i=e,t.DefaultRandomGenerator=i,t.defaultRandomGenerator=new i,t.oaepEncode=function(t,e,r,n){return o(t,e,r=r||new Uint8Array(0),n=n||new i)},t.OAEP_ENCODE=function(t,e,r){return o(128,e,t,r)},t.MGF1=S,t.maskGenerator=r}(Cryptomathic=Cryptomathic||{}),function(n){var t,i,o,s;t=(t=n.Crypto||(n.Crypto={})).Pkcs1EmsaPadding||(t.Pkcs1EmsaPadding={}),i=n.Error.CrmError,o=n.SignerUserSDK.ErrorTypes,s=n.Utils.ByteArrayUtils.emptyArray,t.EMSA_PKCS1_encode=function(t,e,r){if(r=n.Crypto.CryptoUtils.asn1DigestInfo(r).concat(t),e<r.length+11)throw new i(o.CryptoError,"Intended encoded message length too short.");return t=s(e-r.length-3,255),[0,1].concat(t).concat(0).concat(r)}}(Cryptomathic=Cryptomathic||{}),function(a){var t,c,u;t=(t=a.Crypto||(a.Crypto={})).Rsa||(t.Rsa={}),c=a.Error.CrmError,u=a.Utils.Errors.isEs5Error,t.EncryptRsa=function(t,e,r,n){var i=e.getPublicExponent(),e=e.getModulus(),o=new a.Utils.orcan.Modulus(a.Utils.StringUtils.bytesToHex(e)),i=new a.Utils.orcan.BigNum(a.Utils.StringUtils.bytesToHex(i)),s=e.length;new a.Utils.orcan.BigNum(a.Utils.StringUtils.bytesToHex(t)).powModNAsync(i,o,3,function(t){t=a.Utils.StringUtils.hexToBytes(t.toString().replace(/^0x/,""));t.length<s&&(t=[0].concat(t)),r(t)},function(t){t=u(t)?t.message:t instanceof c?t.getMessage():""+t;n("Error in RSA encryption: "+t)})}}(Cryptomathic=Cryptomathic||{}),function(C){var t;function A(t){for(var e="",r=28;;r-=4)if(e+=(t>>>r&15).toString(16),!r)return e}function E(t,e){return t<<e|t>>>32-e}(t=(t=C.Crypto||(C.Crypto={})).SHA1||(t.SHA1={})).SIGNATURE_ID="SHA1withRSA",t.DIGEST_SIZE=20,t.hash=function(t){var e,r=C.Utils.StringUtils.bytes2string(t),n=(t=[1732584193,4023233417,2562383102,271733878,3285377520])[0],i=t[1],o=t[2],s=t[3],a=t[4],c=4294967295,u=new Array(80),t=r.length,g=[];for(r+=String.fromCharCode(128);r.length%4;)r+=String.fromCharCode(0);for(m=0;m<r.length;m+=4)g.push(r.charCodeAt(m)<<24|r.charCodeAt(m+1)<<16|r.charCodeAt(m+2)<<8|r.charCodeAt(m+3));for(;g.length%16!=14;)g.push(0);g.push(t>>>29),g.push(t<<3&c);for(var h=0;h<g.length;h+=16){for(m=0;m<16;m++)u[m]=g[h+m];for(m=16;m<=79;m++)u[m]=E(u[m-3]^u[m-8]^u[m-14]^u[m-16],1);for(var l=[n,i,o,s,a],p=l[0],f=l[1],y=l[2],d=l[3],S=l[4],m=0;m<=19;m++)e=E(p,5)+(f&y|~f&d)+S+u[m]+1518500249&c,S=d,d=y,y=E(f,30),f=p,p=e;for(m=20;m<=39;m++)e=E(p,5)+(f^y^d)+S+u[m]+1859775393&c,S=d,d=y,y=E(f,30),f=p,p=e;for(m=40;m<=59;m++)e=E(p,5)+(f&y|f&d|y&d)+S+u[m]+2400959708&c,S=d,d=y,y=E(f,30),f=p,p=e;for(m=60;m<=79;m++)e=E(p,5)+(f^y^d)+S+u[m]+3395469782&c,S=d,d=y,y=E(f,30),f=p,p=e;n=n+p&c,i=i+f&c,o=o+y&c,s=s+d&c,a=a+S&c}return C.Utils.StringUtils.hexToBytes(A(n)+A(i)+A(o)+A(s)+A(a))}}(Cryptomathic=Cryptomathic||{}),function(e){var t,r,n;t=e.Crypto||(e.Crypto={}),(r=t.SHA224||(t.SHA224={})).SIGNATURE_ID="SHA224withRSA",r.DIGEST_SIZE=28,n=Object.freeze([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]),r.hash=function(t){return e.Crypto.Sha2w32Support.hash(t,n).slice(0,r.DIGEST_SIZE)}}(Cryptomathic=Cryptomathic||{}),function(e){var t,r;(t=(t=e.Crypto||(e.Crypto={})).SHA256||(t.SHA256={})).SIGNATURE_ID="SHA256withRSA",t.DIGEST_SIZE=32,r=Object.freeze([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),t.hash=function(t){return e.Crypto.Sha2w32Support.hash(t,r)}}(Cryptomathic=Cryptomathic||{}),function(e){var t,r,n;t=e.Crypto||(e.Crypto={}),(r=t.SHA384||(t.SHA384={})).SIGNATURE_ID="SHA384withRSA",r.DIGEST_SIZE=48,r.hash=function(t){return e.Crypto.Sha2w64Support.hash(t,n).slice(0,r.DIGEST_SIZE)},n=Object.freeze([t.Int64.fromInts(3418070365,3238371032),t.Int64.fromInts(1654270250,914150663),t.Int64.fromInts(2438529370,812702999),t.Int64.fromInts(355462360,4144912697),t.Int64.fromInts(1731405415,4290775857),t.Int64.fromInts(2394180231,1750603025),t.Int64.fromInts(3675008525,1694076839),t.Int64.fromInts(1203062813,3204075428)])}(Cryptomathic=Cryptomathic||{}),function(e){var t;function r(){}t=e.Crypto||(e.Crypto={}),r.hash=function(t){return e.Crypto.Sha2w64Support.hash(t,r.H0)},r.SIGNATURE_ID="SHA512withRSA",r.DIGEST_SIZE=64,r.H0=[t.Int64.fromInts(1779033703,4089235720),t.Int64.fromInts(3144134277,2227873595),t.Int64.fromInts(1013904242,4271175723),t.Int64.fromInts(2773480762,1595750129),t.Int64.fromInts(1359893119,2917565137),t.Int64.fromInts(2600822924,725511199),t.Int64.fromInts(528734635,4215389547),t.Int64.fromInts(1541459225,327033209)],t.SHA512=r}(Cryptomathic=Cryptomathic||{}),function(o){var t,e;function s(t){return e(t.length).concat(t)}t=(t=o.Crypto||(o.Crypto={})).SessionKeyUtils||(t.SessionKeyUtils={}),e=o.Messages.Tags.encodeInt,t.createSessionKey=function(t,e,r,n,i){return t=[].concat(s(t),s(e),s(r),s(n),s(i)),o.Crypto.SHA256.hash(t)},t.deriveNewKey=function(t,e,r,n){return t=[].concat(s(t),s(e),null===r?[]:s(o.Utils.StringUtils.string2bytes(r))),e=o.Crypto.SHA256.hash(t),o.Utils.ByteArrayUtils.xor(n,e)}}(Cryptomathic=Cryptomathic||{}),function(t){var e,u,g;function S(t,e){return t>>>e|t<<32-e}function h(t,e,r){for(var n,i,o,s=new Array(64),a=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],c=r[0],u=r[1],g=r[2],h=r[3],l=r[4],p=r[5],f=r[6],y=r[7],d=0;d<16;d++)s[d]=(t[4*d+e]<<24)+(t[4*d+e+1]<<16)+(t[4*d+e+2]<<8)+t[4*d+e+3];for(d=16;d<64;d++)s[d]=4294967295&(S(o=s[d-2],17)^S(o,19)^o>>>10)+s[d-7]+(S(o=s[d-15],7)^S(o,18)^o>>>3)+s[d-16];for(d=0;d<64;d++)n=y+(S(l,6)^S(l,11)^S(l,25))+(l&p^~l&f)+a[d]+s[d]&4294967295,i=4294967295&(S(c,2)^S(c,13)^S(c,22))+(c&u^c&g^u&g),y=f,f=p,p=l,l=h+n&4294967295,h=g,g=u,u=c,c=n+i&4294967295;return r[0]=c+r[0]&4294967295,r[1]=u+r[1]&4294967295,r[2]=g+r[2]&4294967295,r[3]=h+r[3]&4294967295,r[4]=l+r[4]&4294967295,r[5]=p+r[5]&4294967295,r[6]=f+r[6]&4294967295,r[7]=y+r[7]&4294967295,r}e=(e=t.Crypto||(t.Crypto={})).Sha2w32Support||(e.Sha2w32Support={}),u=t.Error.CrmError,g=t.SignerUserSDK.ErrorTypes,e.DIGEST_SIZE=32,e.HMAC_BLOCKSIZE=64,e.hash=function(t,e){var r=e.slice(0);if(4294967295<(e=t.length))throw new u(g.InvalidArgumentError,"Message too long.");for(var n=Math.floor(e/64),i=0;i<n;i++)r=h(t,64*i,r);var o=e-64*n,s=o<=55?64:128,a=new Uint8Array(s);for(i=0;i<o;i++)a[i]=t[i+64*n];for(a[i]=128,i++;i<s-8;i++)a[i]=0;var e=8*e,c=(a[i++]=0,a[i++]=0,a[i++]=0,a[i++]=0,a[i++]=e>>>24&255,a[i++]=e>>>16&255,a[i++]=e>>>8&255,a[i++]=255&e,r=h(a,0,r),128===s&&(r=h(a,64,r)),new Array(32));for(i=0;i<8;i++)c[4*i]=r[i]>>>24&255,c[4*i+1]=r[i]>>>16&255,c[4*i+2]=r[i]>>>8&255,c[4*i+3]=255&r[i];return c}}(Cryptomathic=Cryptomathic||{}),function(m){var C,A;function E(t,e,r){return[t[0]&e[0]^~t[0]&r[0],t[1]&e[1]^~t[1]&r[1]]}function T(t,e,r){return[t[0]&e[0]^t[0]&r[0]^e[0]&r[0],t[1]&e[1]^t[1]&r[1]^e[1]&r[1]]}function I(t){return[C.Int64.rotr_high(t,28)^C.Int64.rotr_high(t,34)^C.Int64.rotr_high(t,39),C.Int64.rotr_low(t,28)^C.Int64.rotr_low(t,34)^C.Int64.rotr_low(t,39)]}function w(t){return[C.Int64.rotr_high(t,14)^C.Int64.rotr_high(t,18)^C.Int64.rotr_high(t,41),C.Int64.rotr_low(t,14)^C.Int64.rotr_low(t,18)^C.Int64.rotr_low(t,41)]}function v(t){return[C.Int64.rotr_high(t,1)^C.Int64.rotr_high(t,8)^C.Int64.shr_high(t,7),C.Int64.rotr_low(t,1)^C.Int64.rotr_low(t,8)^C.Int64.shr_low(t,7)]}function b(t){return[C.Int64.rotr_high(t,19)^C.Int64.rotr_high(t,61)^C.Int64.shr_high(t,6),C.Int64.rotr_low(t,19)^C.Int64.rotr_low(t,61)^C.Int64.shr_low(t,6)]}function t(t){var e=parseInt(t.substr(0,8),16),t=parseInt(t.substr(8,8),16);return C.Int64.fromInts(e,t)}C=m.Crypto||(m.Crypto={}),(A=C.Sha2w64Support||(C.Sha2w64Support={})).ch=E,A.maj=T,A.Sigma0_512=I,A.Sigma1_512=w,A.sigma0_512=v,A.sigma1_512=b,A.K=Object.freeze([t("428a2f98d728ae22"),t("7137449123ef65cd"),t("b5c0fbcfec4d3b2f"),t("e9b5dba58189dbbc"),t("3956c25bf348b538"),t("59f111f1b605d019"),t("923f82a4af194f9b"),t("ab1c5ed5da6d8118"),t("d807aa98a3030242"),t("12835b0145706fbe"),t("243185be4ee4b28c"),t("550c7dc3d5ffb4e2"),t("72be5d74f27b896f"),t("80deb1fe3b1696b1"),t("9bdc06a725c71235"),t("c19bf174cf692694"),t("e49b69c19ef14ad2"),t("efbe4786384f25e3"),t("0fc19dc68b8cd5b5"),t("240ca1cc77ac9c65"),t("2de92c6f592b0275"),t("4a7484aa6ea6e483"),t("5cb0a9dcbd41fbd4"),t("76f988da831153b5"),t("983e5152ee66dfab"),t("a831c66d2db43210"),t("b00327c898fb213f"),t("bf597fc7beef0ee4"),t("c6e00bf33da88fc2"),t("d5a79147930aa725"),t("06ca6351e003826f"),t("142929670a0e6e70"),t("27b70a8546d22ffc"),t("2e1b21385c26c926"),t("4d2c6dfc5ac42aed"),t("53380d139d95b3df"),t("650a73548baf63de"),t("766a0abb3c77b2a8"),t("81c2c92e47edaee6"),t("92722c851482353b"),t("a2bfe8a14cf10364"),t("a81a664bbc423001"),t("c24b8b70d0f89791"),t("c76c51a30654be30"),t("d192e819d6ef5218"),t("d69906245565a910"),t("f40e35855771202a"),t("106aa07032bbd1b8"),t("19a4c116b8d2d0c8"),t("1e376c085141ab53"),t("2748774cdf8eeb99"),t("34b0bcb5e19b48a8"),t("391c0cb3c5c95a63"),t("4ed8aa4ae3418acb"),t("5b9cca4f7763e373"),t("682e6ff3d6b2b8a3"),t("748f82ee5defb2fc"),t("78a5636f43172f60"),t("84c87814a1f0ab72"),t("8cc702081a6439ec"),t("90befffa23631e28"),t("a4506cebde82bde9"),t("bef9a3f7b2c67915"),t("c67178f2e372532b"),t("ca273eceea26619c"),t("d186b8c721c0c207"),t("eada7dd6cde0eb1e"),t("f57d4f7fee6ed178"),t("06f067aa72176fba"),t("0a637dc5a2c898a6"),t("113f9804bef90dae"),t("1b710b35131c471b"),t("28db77f523047d84"),t("32caab7b40c72493"),t("3c9ebe0a15c9bebc"),t("431d67c49c100d4c"),t("4cc5d4becb3e42b6"),t("597f299cfc657e2a"),t("5fcb6fab3ad6faec"),t("6c44198c4a475817")]),A.hash=function(t,e){for(var r=new m.Crypto.MessageBlockStream(t),n=e.slice(0);r.hasNext();){for(var i=void 0,o=r.getNext(),s=new Array(80),i=0;i<16;i++)s[i]=o[i];for(i=16;i<80;i++)s[i]=C.Int64.sum(b(s[i-2]),s[i-7],v(s[i-15]),s[i-16]);var a=n[0],c=n[1],u=n[2],g=n[3],h=n[4],l=n[5],p=n[6],f=n[7];for(i=0;i<80;i++)var y=C.Int64.sum(f,w(h),E(h,l,p),A.K[i],s[i]),d=C.Int64.add(I(a),T(a,c,u)),f=p,p=l,l=h,h=C.Int64.add(g,y),g=u,u=c,c=a,a=C.Int64.add(y,d);var S=new Array(8);S[0]=C.Int64.add(a,n[0]),S[1]=C.Int64.add(c,n[1]),S[2]=C.Int64.add(u,n[2]),S[3]=C.Int64.add(g,n[3]),S[4]=C.Int64.add(h,n[4]),S[5]=C.Int64.add(l,n[5]),S[6]=C.Int64.add(p,n[6]),S[7]=C.Int64.add(f,n[7]),n=S}return C.Int64.convertInt64ArrayToByteArray(n)}}(Cryptomathic=Cryptomathic||{}),function(n){var t;(t=(t=n.Crypto||(n.Crypto={})).SignHelper||(t.SignHelper={})).pkcs1Padding=function(t,e){return new n.Crypto.SignatureRequestPkcs1(t,e,null)},t.pkcs1PaddingWithHash=function(t,e){return new n.Crypto.SignatureRequestPkcs1(t,null,e)},t.pssPadding=function(t,e,r){return new n.Crypto.SignatureRequestPss(t,e,null,r)},t.pssPaddingWithHash=function(t,e,r){return new n.Crypto.SignatureRequestPss(t,null,e,r)},t.encodePkcs7=function(t,e){return new n.Crypto.SignatureRequestPkcs7Wrapper(t,e)}}(Cryptomathic=Cryptomathic||{}),function(i){!function(t){var e=i.ASN1.AlgorithmIdentifier,r=i.ASN1.Asn1Constants;function n(t,e,r){this.paddingType=i.Crypto.SignatureRequestType.PKCS1,this.useSalt=!1,this.digest=t,this.hash=r,this.message=e;r=i.Crypto.Digest.toAlgorithm(t);if(!this.hash&&!this.message)throw new i.Error.CrmError(i.SignerUserSDK.ErrorTypes.CryptoError,"Missing hash or message in PKCS1 SignatureRequest.");this.hash||(this.hash=r.hash(this.message))}n.prototype.getAlgorithmIdentifier=function(){switch(this.digest){case t.Digest.SHA256:return new e(r.signRsaPkcs1Sha256).encode();case t.Digest.SHA384:return new e(r.signRsaPkcs1Sha384).encode();case t.Digest.SHA512:return new e(r.signRsaPkcs1Sha512).encode()}throw new i.Error.CrmError(i.SignerUserSDK.ErrorTypes.CryptoError,"Unsupported Digest for PKCS1 SignatureRequest: "+this.digest.toString())},n.prototype.getPaddedRequest=function(t){t=i.ASN1.SubjectPublicKeyInfo.createFromEncoded(t.KEY_PUBLIC_KEY).getModulus().length;return i.Crypto.Pkcs1EmsaPadding.EMSA_PKCS1_encode(this.hash,t,this.digest)},n.prototype.encodeSignerResponse=function(t){return t},t.SignatureRequestPkcs1=n}(i.Crypto||(i.Crypto={}))}(Cryptomathic=Cryptomathic||{}),function(n){!function(t){function e(t,e){this.wrappedRequest=t,this.includeMessageInSignature=e,this.pkcs7=n.ASN1.PKCS7}Object.defineProperty(e.prototype,"digest",{get:function(){return this.wrappedRequest.digest},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hash",{get:function(){return this.wrappedRequest.hash},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"message",{get:function(){return this.wrappedRequest.message},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingType",{get:function(){return this.wrappedRequest.paddingType},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"useSalt",{get:function(){return this.wrappedRequest.useSalt},enumerable:!1,configurable:!0}),e.prototype.getAlgorithmIdentifier=function(){return this.wrappedRequest.getAlgorithmIdentifier()},e.prototype.getPaddedRequest=function(t){if(t.KEY_CERT_BYTES)return this.wrappedRequest.getPaddedRequest(t);throw new n.Error.CrmError(n.SignerUserSDK.ErrorTypes.InvalidArgumentError,"The supplied key does not have a certificate, which is required for PKCS#7 signatures")},e.prototype.encodeSignerResponse=function(t,e){var r=this.includeMessageInSignature?this.message:null;switch(this.paddingType){case n.Crypto.SignatureRequestType.PKCS1:return this.pkcs7.createPkcs7SignedMessage(e.KEY_CERT_BYTES,this.wrappedRequest.encodeSignerResponse(t,e),r,this.digest);case n.Crypto.SignatureRequestType.PSS:return this.pkcs7.createPssPkcs7SignedMessage(e.KEY_CERT_BYTES,this.wrappedRequest.encodeSignerResponse(t,e),r,this.digest,this.useSalt);default:throw new n.Error.CrmError(n.SignerUserSDK.ErrorTypes.CryptoError,"Unsupported encoding.")}},t.SignatureRequestPkcs7Wrapper=e}(n.Crypto||(n.Crypto={}))}(Cryptomathic=Cryptomathic||{}),function(u){!function(e){var a=u.Error.CrmError,c=u.SignerUserSDK.ErrorTypes;function t(t,e,r,n){if(this.paddingType=u.Crypto.SignatureRequestType.PSS,this.digest=t,this.message=e,this.hash=r,this.useSalt=n,this.digestAlgorithm=u.Crypto.Digest.toAlgorithm(t),this.saltLength=n?this.digestAlgorithm.DIGEST_SIZE:0,!this.hash&&!this.message)throw new u.Error.CrmError(u.SignerUserSDK.ErrorTypes.CryptoError,"Missing hash or message in PSS SignatureRequest.");this.hash||(this.hash=this.digestAlgorithm.hash(this.message))}t.prototype.getAlgorithmIdentifier=function(){var t=this.useSalt?this.hash.length:0;switch(this.digest){case e.Digest.SHA256:return u.ASN1.encodePssAlgorithmId("SHA256/RSA",t).encode();case e.Digest.SHA384:return u.ASN1.encodePssAlgorithmId("SHA384/RSA",t).encode();case e.Digest.SHA512:return u.ASN1.encodePssAlgorithmId("SHA512/RSA",t).encode()}throw new u.Error.CrmError(u.SignerUserSDK.ErrorTypes.CryptoError,"Unsupported Digest for PKCS1 SignatureRequest: "+this.digest.toString())},t.prototype.getPaddedRequest=function(t){return this.pssPadHash(this.digestAlgorithm,this.saltLength,t,this.hash)},t.prototype.pssPadHash=function(t,e,r,n){r=u.Messages.getKeySize(r);if(n.length+e+2>r)throw new a(c.InvalidArgumentError,"key to small to encode the hash");var i=crypto.getRandomValues(new Uint8Array(e)),i=Array.from(i),o=u.Utils.ByteArrayUtils.emptyArray(8).concat(n,i),o=t.hash(o),r=r-e-n.length-2,e=u.Utils.ByteArrayUtils.emptyArray(r).concat([1],i),s=u.Crypto.OAEP.maskGenerator(t,o,e.length),n=e.map(function(t,e){return t^s[e]});return n[0]=127&n[0],n.concat(o,[188])},t.prototype.encodeSignerResponse=function(t){return t},e.SignatureRequestPss=t}(u.Crypto||(u.Crypto={}))}(Cryptomathic=Cryptomathic||{}),function(t){(t=(t=t.Crypto||(t.Crypto={})).SignatureRequestType||(t.SignatureRequestType={}))[t.PSS=1]="PSS",t[t.PKCS1=2]="PKCS1"}(Cryptomathic=Cryptomathic||{}),function(t){(t=(t=t.Messages||(t.Messages={})).AuthLevel||(t.AuthLevel={}))[t.NONE=0]="NONE",t[t.PASSWORD_ONLY=1]="PASSWORD_ONLY",t[t.TWO_FACTOR=2]="TWO_FACTOR"}(Cryptomathic=Cryptomathic||{}),function(t){(t=(t=t.Messages||(t.Messages={})).CommandIDs||(t.CommandIDs={}))[t.Get_Challenge=12]="Get_Challenge",t[t.Escalate=13]="Escalate",t[t.Escalate_and_Sign=14]="Escalate_and_Sign",t[t.Do_Operation=22]="Do_Operation",t[t.Noop=99]="Noop",t[t.Logoff=100]="Logoff"}(Cryptomathic=Cryptomathic||{}),function(t){(t=(t=t.Messages||(t.Messages={})).Tags||(t.Tags={})).Command={sessionId:t.longTag(1e4),hsmEncryption:t.bytesTag(10001),serverEncryption:t.bytesTag(10002),createSessionProtocolId:t.byteTag(10010),sckId:t.longTag(10011),sckEncryption:t.bytesTag(10012),samlAssertion:t.bytesTag(10013),activeKeysOnly:t.booleanTag(10014)}}(Cryptomathic=Cryptomathic||{}),function(t){var i,e,o;i=t.Messages||(t.Messages={}),e=i.Request||(i.Request={}),o=t.Messages.Tags.Command,e.createSessionRequest=function(t,e,r,n){return t=t,e=e,r=r,n=n,t=o.createSessionProtocolId.encode(1).concat(o.sckId.encode(t),o.sckEncryption.encode(e),o.activeKeysOnly.encode(r),o.samlAssertion.encode(n)),i.createRequest("SSCP",t)}}(Cryptomathic=Cryptomathic||{}),function(t){var e,r,n;e=t.Messages||(t.Messages={}),e=(r=e.Response||(e.Response={})).CreateSession||(r.CreateSession={}),n=t.Messages.Tags.Response,e.parse=function(t){return{authenticatorEnabled:(t=r.parseSignerResponse(t,"RSCP","Create session")).get(n.authenticatorEnabled),encryptedContent:t.get(n.hsmEncryption),sessionID:t.get(n.sessionId),softwareEncryptedContent:t.get(n.serverEncryption)}}}(Cryptomathic=Cryptomathic||{}),function(e){var t;(t=e.Messages||(e.Messages={})).KeyEntry=function(t,e,r,n,i,o,s){return{KEY_ID:t,KEY_PUBLIC_KEY:e,KEY_EXPIRED_DATE:r,KEY_CERT_BYTES:n,KEY_CERT_DISPLAY_TEXT:i,OWNING_POLICY:s,KEY_DIGEST:o}},t.getKeySize=function(t){return e.ASN1.SubjectPublicKeyInfo.createFromEncoded(t.KEY_PUBLIC_KEY).getModulus().length}}(Cryptomathic=Cryptomathic||{}),function(r){var t,n,i,o;function s(t,e){return r.Utils.StringUtils.string2bytes(t).concat(n(2),i(e.length),e)}t=r.Messages||(r.Messages={}),n=r.Messages.Tags.encodeByte,i=r.Messages.Tags.encodeInt,o=r.Messages.Tags.Command,t.createRequest=s,t.createUserRequest=function(t,e,r){return s("SAUT",(e=e,r=r,o.sessionId.encode(t).concat(o.hsmEncryption.encode(e),o.serverEncryption.encode(r))))}}(Cryptomathic=Cryptomathic||{}),function(t){(t.Messages||(t.Messages={})).PolicyEntry=function(t,e,r,n,i,o,s,a,c,u,g,h){return{POLICY_ID:t,POLICY_NAME:e,POLICY_AUTH_LEVEL:r,POLICY_KEY_LEVEL:n,POLICY_CAN_SIGN:i,POLICY_CAN_DECRYPT:o,POLICY_ENABLED:s,POLICY_ACCEPTED_TOKENS:a,KEY_LIST:c,SIGNATURE_ALGORITHM:u,SIGNATURE_TYPE:g,HASH_ALGORITHM:h}}}(Cryptomathic=Cryptomathic||{}),function(t){(t=(t=t.Messages||(t.Messages={})).SignerErrorCodes||(t.SignerErrorCodes={}))[t.OK=0]="OK",t[t.COMMAND_FAILED_ON_SERVER=17]="COMMAND_FAILED_ON_SERVER",t[t.UNEXPECTED_COMMAND_PARAMETER=33]="UNEXPECTED_COMMAND_PARAMETER",t[t.MALFORMED_COMMAND_PARAMETER=34]="MALFORMED_COMMAND_PARAMETER",t[t.COMMAND_DISABLED=35]="COMMAND_DISABLED",t[t.INSUFFICIENT_PRIVILEGES=36]="INSUFFICIENT_PRIVILEGES",t[t.USER_DISABLED=37]="USER_DISABLED",t[t.KEY_DISABLED=38]="KEY_DISABLED",t[t.NO_TOKENS_AVAILABLE=39]="NO_TOKENS_AVAILABLE",t[t.AUTHENTICATION_FAILED_TRY_AGAIN=40]="AUTHENTICATION_FAILED_TRY_AGAIN",t[t.AUTHENTICATION_FAILED_FORCED_LOGOFF=41]="AUTHENTICATION_FAILED_FORCED_LOGOFF",t[t.AUTHENTICATION_NO_CHALLENGE=42]="AUTHENTICATION_NO_CHALLENGE",t[t.TOO_MANY_FAILED_ATTEMPTS_TOKEN_IS_SUSPENDED=43]="TOO_MANY_FAILED_ATTEMPTS_TOKEN_IS_SUSPENDED",t[t.AUTHENTICATION_BAD_TOKEN_DATA=44]="AUTHENTICATION_BAD_TOKEN_DATA",t[t.AUTHENTICATION_TOKEN_NOT_USABLE=45]="AUTHENTICATION_TOKEN_NOT_USABLE",t[t.USER_SUSPENDED=48]="USER_SUSPENDED",t[t.USER_IS_ENABLED=51]="USER_IS_ENABLED",t[t.PRIVILEGE_NOT_FOUND=52]="PRIVILEGE_NOT_FOUND",t[t.KEY_ALREADY_HAS_CERTIFICATE=53]="KEY_ALREADY_HAS_CERTIFICATE",t[t.CERTIFICATE_DOES_NOT_MATCH_KEY=54]="CERTIFICATE_DOES_NOT_MATCH_KEY",t[t.KEY_DEPRECATED=55]="KEY_DEPRECATED",t[t.GENERAL_ERROR=1e3]="GENERAL_ERROR",t[t.FORCED_LOGOFF=1001]="FORCED_LOGOFF",t[t.COMMUNICATION_ERROR=1002]="COMMUNICATION_ERROR",t[t.NOT_LOGGED_IN=1003]="NOT_LOGGED_IN",t[t.DESERIALISATION_ERROR=1004]="DESERIALISATION_ERROR",t[t.INTERMITTENT_SERVER_ERROR_TRY_AGAIN=1005]="INTERMITTENT_SERVER_ERROR_TRY_AGAIN",t[t.AUTHENTICATOR_DISABLED=1006]="AUTHENTICATOR_DISABLED",t[t.INVALID_SAML_ASSERTION=1007]="INVALID_SAML_ASSERTION"}(Cryptomathic=Cryptomathic||{}),function(t){var r;t=t.Messages||(t.Messages={}),(r=t.SignerErrorCodes||(t.SignerErrorCodes={})).getError=function(t){var e=r[t];return e||t.toString()}}(Cryptomathic=Cryptomathic||{}),function(t){var e,i,o,s;e=(e=t.Utils||(t.Utils={})).Asn1||(e.Asn1={}),i=t.ASN1.ASN1SubObject,o=t.Error.CrmError,s=t.SignerUserSDK.ErrorTypes,e.readTag=function(t,e,r,n){if((t=i.decode(t,e)).getTag()!==r)throw new o(s.SerializationError,"ASN.1 is not in right format. "+n);return t},e.calcLength=function(t){return 128==(128&t)?1+(127&t):2+t}}(Cryptomathic=Cryptomathic||{}),function(s){var t,a,c,u;function g(t){var e=t>>12&63,r=t>>6&63,n=63&t;return u.charAt(t>>18)+u.charAt(e)+u.charAt(r)+u.charAt(n)}t=(t=s.Utils||(s.Utils={})).Base64||(t.Base64={}),a=s.Error.CrmError,c=s.SignerUserSDK.ErrorTypes,t.encode=function(t){for(var e=s.Utils.StringUtils.bytes2string(t),r=(t=e.length)%3,n=t-r,i="",o=0;o<n;o+=3)i+=g((e.charCodeAt(o)<<16)+(e.charCodeAt(o+1)<<8)+e.charCodeAt(o+2));return 1==r&&(i+=g(e.charCodeAt(o)<<16).slice(0,2)+"=="),2==r&&(i+=g((e.charCodeAt(o)<<16)+(e.charCodeAt(o+1)<<8)).slice(0,3)+"="),i},t.decode=function(t){if(t.length%4!=0)throw new a(c.InvalidArgumentError,"Invalid base64 encoding, length not divisible by 4");for(var e=[],r=0;r<t.length;r+=4){var n=u.indexOf(t[r]),i=u.indexOf(t[r+1]),o=u.indexOf(t[r+2]),s=u.indexOf(t[r+3]);if(e.push(n<<2|i>>4),o<64&&e.push((15&i)<<4|o>>2),s<64){if(64===i)throw new a(c.InvalidArgumentError,"Invalid base64 padding");e.push((3&o)<<6|s)}}return e},u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}(Cryptomathic=Cryptomathic||{}),function(t){(function(e){function t(t){this.modulus=new e.BigNum(3),this.mu=new e.BigNum(1),this.k=1,this.bkplus1=new e.BigNum(1),this.b2k=new e.BigNum(1),this.initWith(t)}t.prototype.initWith=function(t){"object"!=typeof t&&(t=new e.BigNum(t)),this.modulus=t.copy(),this.k=t.numDigs(),this.b2k=new e.BigNum(1).radixMul(2*this.k),this.mu=this.b2k.divMod(t)[0],this.bkplus1=new e.BigNum(1).radixMul(this.k+1)},e.Modulus=t})((t=t.Utils||(t.Utils={})).orcan||(t.orcan={}))}(Cryptomathic=Cryptomathic||{}),function(r){var t,n,i,o,s,a;t=(t=r.Utils||(r.Utils={})).SignatureAlgorithmParametersParser||(t.SignatureAlgorithmParametersParser={}),n=r.Error.CrmError,i=r.SignerUserSDK.ErrorTypes,o=r.Utils.Asn1.calcLength,s=r.ASN1.ByteArrayConstants,a=r.Utils.Asn1.readTag,t.extractHashAlgorithmOid=function(t){var e=r.Utils.StringUtils.bytesToHex,t=t.slice(0),t=a(t,0,48,"Sequence tag is incorrect"),t=a(t.getBytes(),0,160,"The Hash AlgorithmIdentifier tag is incorrect"),t=a(t.getBytes(),0,48,"Sequence tag is incorrect");if((t=e(a(t.getBytes(),0,6,"OID tag is incorrect").getBytes()))===e(s.sha256Oid.slice(2)))return r.Crypto.HashAlgorithm.SHA256;if(t===e(s.sha384Oid.slice(2)))return r.Crypto.HashAlgorithm.SHA384;if(t===e(s.sha512Oid.slice(2)))return r.Crypto.HashAlgorithm.SHA512;throw new n(i.SerializationError,"Algorithm Parameters is not in right format; unknown hash with OID:"+t)},t.extractSaltLength=function(t){var t=t.slice(0),t=a(t,0,48,"Sequence tag is incorrect"),e=a(t.getBytes(),0,160,"The Hash AlgorithmIdentifier tag is incorrect"),e=o(e.getBytes().length),r=a(t.getBytes(),e,161,"The MGF AlgorithmIdentifier tag is incorrect"),e=e+o(r.getBytes().length),r=a(t.getBytes(),e,162,"The Salt tag is incorrect");return a(r.getBytes(),0,2,"The Integer tag is incorrect").getBytes()[0]}}(Cryptomathic=Cryptomathic||{}),function(i){var o,t,s,a,c,e,u;function g(t){t=t.slice(0),t=e(t,0,48,"Sequence tag is incorrect");return e(t.getBytes(),0,6,"The OID tag is incorrect").getBytes()}o=i.Utils||(i.Utils={}),t=o.SignatureAlgorithmParser||(o.SignatureAlgorithmParser={}),s=i.Error.CrmError,a=i.SignerUserSDK.ErrorTypes,c=i.Utils.Asn1.calcLength,e=i.Utils.Asn1.readTag,u=i.ASN1.ByteArrayConstants,t.extractSignatureType=function(t){var e=i.Utils.StringUtils.bytesToHex,r=g(t),n=e(r);if(n===e(u.signRsaRaw.slice(2)))return i.Messages.SignatureType.RAW;if(n===e(u.signRsaPss.slice(2)))return r=t.slice(c(c(r.length))),0===o.SignatureAlgorithmParametersParser.extractSaltLength(r)?i.Messages.SignatureType.SIGN_PSS_UNSALTED:i.Messages.SignatureType.SIGN_PSS;if(n===e(u.signRsaPkcs1Sha256.slice(2))||n===e(u.signRsaPkcs1Sha384.slice(2))||n===e(u.signRsaPkcs1Sha512.slice(2)))return i.Messages.SignatureType.SIGN_PKCS1;if(n===e(u.signEcdsaSha256.slice(2))||n===e(u.signEcdsaSha384.slice(2))||n===e(u.signEcdsaSha512.slice(2)))return i.Messages.SignatureType.SIGN_ECDSA;throw new s(a.SerializationError,"Unknown algorithm identifier: "+i.Utils.StringUtils.bytesToHex(t))},t.extractHashAlgorithm=function(t){var e=i.Utils.StringUtils.bytesToHex,r=g(t),n=e(r);if(n===e(u.signRsaRaw.slice(2)))return null;if(n===e(u.signRsaPss.slice(2)))return r=t.slice(c(c(r.length))),o.SignatureAlgorithmParametersParser.extractHashAlgorithmOid(r);if(n===e(u.signRsaPkcs1Sha256.slice(2))||n===e(u.signEcdsaSha256.slice(2)))return i.Crypto.HashAlgorithm.SHA256;if(n===e(u.signRsaPkcs1Sha384.slice(2))||n===e(u.signEcdsaSha384.slice(2)))return i.Crypto.HashAlgorithm.SHA384;if(n===e(u.signRsaPkcs1Sha512.slice(2))||n===e(u.signEcdsaSha512.slice(2)))return i.Crypto.HashAlgorithm.SHA512;throw new s(a.SerializationError,"Unknown algorithm identifier: "+i.Utils.StringUtils.bytesToHex(t))}}(Cryptomathic=Cryptomathic||{}),function(r){var t;(function(t){function e(){this.softwareKey=null,this.sessionKey=null,this.sessionID=null,this.lastChallengeId=null,this.lastChallengeData=null,this.lastChallengeToken=null,this.sequenceNumber=0,this.sessionAuthLevel=r.Messages.AuthLevel.NONE}e.prototype.incrementSequenceNumber=function(){this.sequenceNumber+=2},e.prototype.getSequenceNumber=function(){return this.sequenceNumber},e.prototype.hasSoftwareKey=function(){return null!==this.softwareKey},e.prototype.getSoftwareKey=function(){return this.softwareKey},e.prototype.setSoftwareKey=function(t){this.softwareKey=t},e.prototype.hasSessionKey=function(){return null!==this.sessionKey},e.prototype.getSessionKey=function(){return this.sessionKey},e.prototype.setSessionKey=function(t){this.sessionKey=t},e.prototype.getSessionID=function(){return this.sessionID},e.prototype.setSessionID=function(t){this.sessionID=t},e.prototype.hasChallenge=function(){return null!=this.lastChallengeId},e.prototype.setLastChallenge=function(t,e,r){"OATH-OCRA"===t.getTokenType()||"SMS"===t.getTokenType()?(this.lastChallengeToken=t,this.lastChallengeId=e,"OATH-OCRA"===t.getTokenType()&&(this.lastChallengeData=r)):(this.lastChallengeToken=null,this.lastChallengeData=null)},e.prototype.prepareEscalateSession=function(t){switch(t.getTokenType()){case"OATH-OCRA":case"SMS":return null!==this.lastChallengeToken&&t.getTokenSerial()!==this.lastChallengeToken.getTokenSerial()?!1:!0;case"OATH-HOTP":case"OATH-TOTP":return this.lastChallengeToken=null,this.lastChallengeData=null,!(this.lastChallengeId=null);default:return!1}},e.prototype.getLastChallengeData=function(){return this.lastChallengeData},e.prototype.getLastChallengeId=function(){return this.lastChallengeId},e.prototype.setSessionAuthLevel=function(t){this.sessionAuthLevel=t},e.prototype.getSessionAuthLevel=function(){return this.sessionAuthLevel},e.prototype.clearLastChallenge=function(){this.lastChallengeData=null,this.lastChallengeToken=null,this.lastChallengeId=null},t.StateObject=e})((t=r.Utils||(r.Utils={})).StateHandler||(t.StateHandler={}))}(Cryptomathic=Cryptomathic||{}),function(t){function e(t){for(var e=Array(Math.floor((t.length+1)/2)),r=t.length/2,n=0;n<r;++n)e[n]=parseInt(t.charAt(2*n),16)<<4|parseInt(t.charAt(2*n+1),16);return e}(t=(t=t.Utils||(t.Utils={})).StringUtils||(t.StringUtils={})).string2bytes=function(t){for(var e=t.length,r=Array(e),n=0;n<e;n++)r[n]=t.charCodeAt(n);return r},t.bytes2string=function(t){for(var e="",r=16384,n=Math.floor(t.length/r),i=0;i<n;++i)e+=String.fromCharCode.apply(null,t.slice(i*r,(i+1)*r));return e+=String.fromCharCode.apply(null,t.slice(i*r))},t.hexToBytes=e,t.bytesToHex=function(t){for(var e="",r=(t=t instanceof Int8Array?new Uint8Array(t):t).length,n=0;n<r;++n){var i=t[n].toString(16);1===i.length&&(e+="0"),e+=i}return e.toUpperCase()},t.toBytes=e}(Cryptomathic=Cryptomathic||{}),function(e){var t;(function(t){var h=e.Error.CrmError,l=e.SignerUserSDK.ErrorTypes,p=24,f=1<<24,y=16777215;function d(t){this.digs=[0],this.digs="object"==typeof t?t.digs.slice(0):"number"==typeof t?[t]:"string"==typeof t?function(t){t=(t=t.replace(/^0x/,"")).replace(/^(00)+/,"");for(var e=[],r=p/4,n=t.length,i=0;i<n;i+=r)e.push(parseInt(t.substring(Math.max(n-i-r,0),n-i),16));return e}(t):[0]}d.prototype.copy=function(){return new d(this)},d.prototype.normalize=function(){for(;1<this.digs.length&&0===this.digs[this.digs.length-1];)this.digs.pop();return this},d.prototype.getDig=function(t){return t>=this.digs.length?0:this.digs[t]},d.prototype.numDigs=function(){return this.digs.length},d.prototype.toString=function(){for(var t,e="",r=this.digs,n=0;n<r.length;n++){for(t=r[n].toString(16);n<r.length-1&&t.length<6;)t="0"+t;e=t+e}return"0x"+(e=e.length%2!=0?"0"+e:e)},d.prototype.dump=function(){return this.digs.join(",")},d.prototype.equals=function(t){"object"!=typeof t&&(t=new d(t));for(var e=0,r=this.digs.length,n=t.digs.length,i=0;i<r||i<n;i++)e|=this.getDig(i)^t.getDig(i);return 0===e},d.prototype.add=function(t){"object"!=typeof t&&(t=new d(t));for(var e,r=new d(0),n=r.digs,i=this.digs,o=t.digs,s=this.digs.length,t=t.digs.length,a=Math.min(s,t),c=Math.max(s,t),u=s===a?o:i,g=0,h=0;h<a;++h)e=i[h]+o[h]+g,n[h]=e&y,g=f<=e?1:0;for(;h<c;++h)e=u[h]+g,n[h]=e&y,g=f<=e?1:0;return 0<g&&n.push(g),r.normalize()},d.prototype.sub=function(t){"object"!=typeof t&&(t=new d(t));var e=new d(0),r=e.digs,n=this.digs,i=t.digs,o=this.digs.length,s=t.digs.length;if(o<s)for(var a=o;a<s;++a)n[a]=0;for(var c,u=0,g=0;g<s;++g)u=0<=(c=n[g]-i[g]-u)?(r[g]=c,0):(r[g]=c+f,1);for(;g<o;++g)u=0<=(c=n[g]-u)?(r[g]=c,0):(r[g]=c+f,1);if(0<u)throw new h(l.BigNumError,"negative number");return e.normalize()},d.prototype.compare=function(t){"object"!=typeof t&&(t=new d(t));var e,r=this.copy().normalize(),t=t.copy().normalize(),n=r.digs,i=t.digs;if(n.length<i.length)return-1;if(n.length>i.length)return 1;for(var o=n.length-1;0<=o;--o){if(0<(e=n[o]-i[o]))return 1;if(e<0)return-1}return 0},d.prototype.shiftLeft=function(t){for(var e=t/p|0,r=t%p,t=new d(0),n=t.digs,i=0;i<e;++i)n.push(0);var o=0,s=e,a=this.digs,c=a.length;for(i=0;i<c;++i,s++)n[s]=(a[i]<<r|o)&y,o=a[i]>>p-r;return 0<o&&t.digs.push(o),t},d.prototype.shiftRight=function(t){for(var e=t/p|0,r=t%p,n=new d(0),i=(n.digs=[],0),o=(1<<r)-1,s=this.digs,a=s.length-1;e<=a;--a)n.digs.unshift(i|s[a]>>r),i=(s[a]&o)<<p-r;return n},d.prototype.radixMul=function(t){for(var e=new d(0),r=(e.digs=[],e.digs),n=0;n<t;++n)r.push(0);return e.digs=e.digs.concat(this.digs),e.normalize()},d.prototype.radixDiv=function(t){var e=new d(0);return t>this.digs.length?e:(e.digs=this.digs.slice(t),e.normalize())},d.prototype.radixMod=function(t){var e=new d(0);return t>this.digs.length?this.normalize():(e.digs=this.digs.slice(0,t),e.normalize())},d.prototype.digitMul=function(t){var e=t.numDigs(),r=this.digs[0],n=new d(0);if(0===r)return n;for(var i,o=t.digs,s=n.digs,a=0,c=0;c<e;++c)i=r*o[c]+a,s[c]=i&y,a=i/f|0;return 0<a&&n.digs.push(a),n.normalize()},d.prototype.karatsubaMul=function(t){var e=Math.min(this.numDigs(),t.numDigs())/2|0,r=this.radixDiv(e),n=this.radixMod(e),i=t.radixDiv(e),t=t.radixMod(e),o=r.mul(i),s=n.mul(t),r=r.add(n),n=i.add(t),i=r.mul(n).sub(o).sub(s);return s.add(i.radixMul(e)).add(o.radixMul(e+e)).normalize()},d.prototype.schoolMul=function(t){for(var e,r=new d(0),n=this.digs,i=t.digs,o=n.length,s=i.length,a=[0,0,0,0,0,0,0,0,0,0,0];a.length<o+s+1;)a=a.concat(a);for(var c=0;c<s;++c){for(var u=0,g=c,h=0;h<o;++h,++g)e=a[g]+n[h]*i[c]+u,a[g]=e&y,u=e/f|0;a[c+o]=u}return r.digs=a,r.normalize()},d.prototype.mul=function(t){return"object"!=typeof t&&(t=new d(t)),this.numDigs()<2?this.digitMul(t):t.numDigs()<2?t.digitMul(this):50<this.numDigs()&&50<t.numDigs()?this.karatsubaMul(t):this.schoolMul(t)},d.prototype.recSquare=function(){var t=this.numDigs()/2|0,e=this.radixDiv(t),r=this.radixMod(t),n=e.square(),i=r.square(),r=r.mul(e),e=r.add(r);return i.add(e.radixMul(t)).add(n.radixMul(t+t)).normalize()},d.prototype.square=function(){return this.numDigs()<2?this.digitMul(this):60<this.numDigs()?this.recSquare():this.schoolMul(this)},d.prototype.squareMod=function(t){return this.square().reduce(t)},d.prototype.highBitnum=function(){for(var t=this.digs.length-1,e=this.digs[t],r=0;0===e&&0<t;)e=this.digs[--t];return 4095<e&&(e>>>=r=12),63<e&&(r+=6,e>>>=6),7<e&&(r+=3,e>>>=3),t*p+r+[0,0,1,1,2,2,2,2][e]},d.prototype.getBit=function(t){return 0!=(this.digs[t/p|0]&1<<t%p)},d.prototype.pow=function(t){for(var e=(t="object"!=typeof t?new d(t):t).highBitnum(),r=new d(1),n=this.copy(),i=0;i<=e;++i)t.getBit(i)&&(r=r.mul(n)),n=n.square();return r.normalize()},d.prototype.powMod=function(t,e){for(var r=(t="object"!=typeof t?new d(t):t).highBitnum(),n=new d(1),i=this.copy(),o=0;o<=r;++o)t.getBit(o)&&(n=n.mulMod(i,e)),i=i.squareMod(e);return n.normalize()},d.prototype.getBits=function(t,e){var r=Math.floor(t*e/p);return this.digs[r]>>>t*e%p&(1<<e)-1},d.prototype.powModN=function(t,e,r){"object"!=typeof t&&(t=new d(t));for(var n=1<<r,i=[new d(1),this],o=2;o<n;++o)i[o]=this.mul(i[o-1]).reduce(e);for(var s,a=t.numDigs()*p/r,c=i[t.getBits(a-1,r)],u=a-2;0<=u;--u){for(var g=0;g<r;++g)c=c.squareMod(e);0!==(s=t.getBits(u,r))&&(c=c.mulMod(i[s],e))}return c.normalize()},d.prototype.powModNAsync=function(n,i,o,s,a){"object"!=typeof n&&(n=new d(n));for(var t=1<<o,c=[new d(1),this],e=2;e<t;++e)c[e]=this.mul(c[e-1]).reduce(i);var r=n.numDigs()*p/o,u=n.getBits(r-1,o),g=c[u],h=r-2;!function t(){var e;try{for(;0<=h;--h){for(var r=0;r<o;++r)g=g.squareMod(i);if(0!==(u=n.getBits(h,o))&&(g=g.mulMod(c[u],i)),0<h&&h%3==0)return--h,void setTimeout(t,0)}e=g.normalize()}catch(t){return void a(t)}s(e)}()},d.prototype.divMod=function(t){var e=(t="object"!=typeof t?new d(t):t).highBitnum()%p,r=this.copy(),r=(e<p-1&&(t=t.shiftLeft(p-1-e),r=this.shiftLeft(p-1-e)),r._divMod(t));return[r[0].normalize(),r[1].shiftRight(p-1-e).normalize()]},d.prototype._divMod=function(t){var e=this.compare(t);if(e<0)return[new d(0),this.copy()];if(0===e)return[new d(1),new d(0)];e=this.numDigs()-t.numDigs()-1;if(0<e)return r=this.radixDiv(e),n=this.radixMod(e),n=(r=r._divMod(t))[1].radixMul(e).add(n)._divMod(t),[r[0].radixMul(e).add(n[0]),n[1]];if(this.numDigs()!==t.numDigs()+1)return[new d(1),this.sub(t)];var r=t.radixMul(1);if(0<=this.compare(r))return[(e=this.sub(r)._divMod(t))[0].add(new d("1000000")),e[1]];for(var n=this.digs[this.digs.length-1]*f+this.digs[this.digs.length-2],i=Math.floor(n/t.digs[t.digs.length-1]),o=t.mul(i=f-1<i?f-1:i);0<o.compare(this);)i--,o=o.sub(t);return[new d(i),this.sub(o)]},d.prototype.div=function(t){return this.divMod(t)[0]},d.prototype.mod=function(t){return this.divMod(t)[1]},d.prototype.reduce=function(t){if(this.numDigs()<t.modulus.numDigs())return this;if(this.numDigs()>2*t.modulus.numDigs())throw new h(l.BigNumError,"BigNum reduce was called with invalid arguments for modulus.");for(var e=t.k+1,r=this.radixDiv(t.k-1).mul(t.mu).radixDiv(e),n=this.radixMod(e),r=r.mul(t.modulus).radixMod(e),i=(n.compare(r)<0?n.add(t.bkplus1):n).sub(r);0<=i.compare(t.modulus);)i=i.sub(t.modulus);return i},d.prototype.mulMod=function(t,e){return this.mul(t).reduce(e)},t.BigNum=d})((t=e.Utils||(e.Utils={})).orcan||(t.orcan={}))}(Cryptomathic=Cryptomathic||{});